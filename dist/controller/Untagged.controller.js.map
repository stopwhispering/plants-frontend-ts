{"version":3,"file":"Untagged.controller.js","names":["BaseController","formatter","ModelsHelper","ImageEventHandlers","Navigation","Untagged","onInit","oRouter","getRoute","attachPatternMatched","_onPatternMatched","imageEventHandlers","getInstance","applyToFragment","bind","oComponent","getModel","setProperty","oEvent","_currentPlantId","parseInt","getParameter","plant_id","handleClose","sNextLayout","getProperty","navTo","layout","onPressReApplyUntaggedFilter","resetUntaggedPhotos","onToggleSelectManyListMode","oSource","getSource","sCurrentType","getType","oUntaggedList","byId","oStatusModel","getView","setType","setMode","onSelectNone","_resetSelection","oList","getItems","forEach","item","setSelected","onSelectAll","onDeleteSelected","aSelectedItems","getSelectedItems","aSelectedImages","map","getBindingContext","getObject","length","MessageToast","show","bCompact","$","closest","MessageBox","confirm","title","onClose","_confirmDeleteSelectedImages","actions","styleClass","sAction","ajax","url","Util","getServiceUrl","type","contentType","data","JSON","stringify","context","done","onAjaxDeletedImagesSuccess","fail","onReceiveErrorGeneric","onAddDetailsPlantToUntaggedImage","oPlant","getPlantById","oBindingContextImage","getParent","oImage","oImagesModel","assignPlantToImage","updateBindings","resetImagesCurrentPlant","onAddPlantNameToUntaggedImage","oSelectedSuggestion","oSelectedPlant","setValue","onPressImagePlantToken","oPlantTag","Error","navToPlant","onIconPressDeleteImage","confirmDeleteImage","onInputImageNewKeywordSubmit","oInput","sKeyword","trim","aKeywords","keywords","find","ele","keyword","push","onTokenizerTokenDelete","sKey","oTokenizer","oModel","sType","removeTokenFromModel"],"sources":["../../src/controller/Untagged.controller.ts"],"sourcesContent":["import BaseController from \"plants/ui/controller/BaseController\"\r\nimport MessageBox from \"sap/m/MessageBox\"\r\nimport formatter from \"plants/ui/model/formatter\"\r\nimport ModelsHelper from \"plants/ui/model/ModelsHelper\"\r\nimport * as Util from \"plants/ui/customClasses/Util\";\r\nimport MessageToast from \"sap/m/MessageToast\"\r\nimport ImageEventHandlers from \"plants/ui/customClasses/ImageEventHandlers\";\r\nimport Event from \"sap/ui/base/Event\";\r\nimport Button from \"sap/m/Button\";\r\nimport { PImage, PImagePlantTag, PKeyword } from \"../definitions/image_entities\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport Input from \"sap/m/Input\";\r\nimport Token from \"sap/m/Token\";\r\nimport Navigation from \"../customClasses/Navigation\";\r\nimport Icon from \"sap/ui/core/Icon\";\r\nimport List from \"sap/m/List\";\r\nimport OverflowToolbarButton from \"sap/m/OverflowToolbarButton\";\r\nimport Tokenizer from \"sap/m/Tokenizer\";\r\nimport { PPlant } from \"../definitions/plant_entities\";\r\n\r\n/**\r\n * @namespace plants.ui.controller\r\n */\r\nexport default class Untagged extends BaseController {\r\n\r\n\tformatter = new formatter();\r\n\r\n\tprivate imageEventHandlers: ImageEventHandlers;\r\n\tprivate _currentPlantId: int;\r\n\r\n\tModelsHelper: ModelsHelper;\r\n\r\n\tonInit() {\r\n\t\tsuper.onInit();\r\n\t\tthis.oRouter.getRoute(\"untagged\").attachPatternMatched(this._onPatternMatched, this);\r\n\t\tthis.imageEventHandlers = ImageEventHandlers.getInstance(this.applyToFragment.bind(this));\r\n\t\t(this.oComponent.getModel('status')).setProperty('/untagged_selectable', false);\r\n\t}\r\n\r\n\tprivate _onPatternMatched(oEvent: Event) {\r\n\t\t// get current plant id\r\n\t\tthis._currentPlantId = parseInt(oEvent.getParameter(\"arguments\").plant_id || this._currentPlantId || \"0\");\r\n\r\n\t\t// this is called when closing untagged view as well\r\n\t\tif (oEvent.getParameter('name') !== 'untagged') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\thandleClose() {\r\n\t\tvar sNextLayout =  this.oComponent.getModel().getProperty(\"/actionButtonsInfo/endColumn/closeColumn\");\r\n\t\tthis.oRouter.navTo(\"detail\", { layout: sNextLayout, plant_id: this._currentPlantId });\r\n\t}\r\n\r\n\tonPressReApplyUntaggedFilter() {\r\n\t\t//triggered by text button to manually filter for untagged images\r\n\t\t// this.resetUntaggedPhotos();\r\n\t\tthis.oComponent.resetUntaggedPhotos();\r\n\t}\r\n\r\n\tonToggleSelectManyListMode(oEvent: Event) {\r\n\t\tconst oSource = <OverflowToolbarButton>oEvent.getSource();\r\n\t\tconst sCurrentType = oSource.getType();  // 'Transparent' or 'Emphasized'\r\n\t\tconst oUntaggedList = <List>this.byId('listImagesUntagged');\r\n\t\tconst oStatusModel = <JSONModel>this.getView().getModel('status');\r\n\t\tif (sCurrentType === 'Transparent') {\r\n\t\t\t// set multi-select mode\r\n\t\t\toSource.setType('Emphasized');\r\n\t\t\toUntaggedList.setMode('MultiSelect');\r\n\t\t\t// we need to save current mode to a model to allow access via expression binding\r\n\t\t\toStatusModel.setProperty('/untagged_selectable', true);\r\n\r\n\t\t} else {\r\n\t\t\t// set default mode\r\n\t\t\toSource.setType('Transparent');\r\n\t\t\toUntaggedList.setMode('None');\r\n\t\t\toStatusModel.setProperty('/untagged_selectable', false);\r\n\t\t}\r\n\t}\r\n\r\n\tonSelectNone(oEvent: Event) {\r\n\t\tthis._resetSelection(<List>this.byId('listImagesUntagged'));\r\n\t}\r\n\r\n\tprivate _resetSelection(oList: List) {\r\n\t\toList.getItems().forEach(function (item) {\r\n\t\t\titem.setSelected(false);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic onSelectAll(oEvent: Event) {\r\n\t\t(<List>this.byId('listImagesUntagged')).getItems().forEach(function (item) {\r\n\t\t\titem.setSelected(true);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic onDeleteSelected(oEvent: Event) {\r\n\t\t//delete 1..n selected images\r\n\t\tconst oList = <List>this.byId('listImagesUntagged');\r\n\t\tconst aSelectedItems = oList.getSelectedItems();\r\n\t\tconst aSelectedImages = <PImage[]> aSelectedItems.map(item => item.getBindingContext('untaggedImages')!.getObject())\r\n\t\tif (aSelectedItems.length == 0) {\r\n\t\t\tMessageToast.show(\"Nothing selected.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar bCompact = !!this.getView().$().closest(\".sapUiSizeCompact\").length;\r\n\t\tMessageBox.confirm(\r\n\t\t\t\"Delete \" + aSelectedItems.length + \" images?\", {\r\n\t\t\ttitle: \"Delete\",\r\n\t\t\tonClose: this._confirmDeleteSelectedImages.bind(this, aSelectedImages),\r\n\t\t\tactions: ['Delete', 'Cancel'],\r\n\t\t\tstyleClass: bCompact ? \"sapUiSizeCompact\" : \"\"\r\n\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tprivate _confirmDeleteSelectedImages(aSelectedImages: PImage[], sAction: string) {\r\n\t\tif (sAction !== 'Delete') {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: Util.getServiceUrl('images/'),\r\n\t\t\ttype: 'DELETE',\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: JSON.stringify({ 'images': aSelectedImages }),\r\n\t\t\tcontext: this\r\n\t\t})\r\n\t\t\t.done(this.onAjaxDeletedImagesSuccess.bind(this, aSelectedImages, this.onSelectNone.bind(this)))\r\n\t\t\t.fail(ModelsHelper.getInstance().onReceiveErrorGeneric.bind(this, 'Images (DELETE)'));\r\n\t}\r\n\r\n\t// // // // // // // // // // // // // // // // // // // // // \r\n\t// Image Event Handlers\r\n\t// // // // // // // // // // // // // // // // // // // // // \t\r\n\tpublic onAddDetailsPlantToUntaggedImage(oEvent: Event){\r\n\t\t//adds current plant in details view to the image in untagged view; triggered from \"<-\"\" Button\r\n\t\tconst oPlant = <PPlant>this.getPlantById(this._currentPlantId);\r\n\t\tconst oBindingContextImage = (<Button> oEvent.getSource()).getParent().getBindingContext(\"untaggedImages\");\r\n\t\tconst oImage = <PImage>oBindingContextImage!.getObject();\r\n\t\tconst oImagesModel = this.oComponent.getModel('images');\r\n\t\tthis.imageEventHandlers.assignPlantToImage(oPlant, oImage, oImagesModel);\r\n\r\n\t\t(<JSONModel>this.getView().getModel('untaggedImages')).updateBindings(true);\r\n\t\tthis.resetImagesCurrentPlant(this._currentPlantId);\r\n\t}\r\n\r\n\tonAddPlantNameToUntaggedImage(oEvent: Event) {\r\n\t\t//adds selected plant in input field (via suggestions) to an image (untagged view)\r\n\t\t//note: there's a same-named function in detail controller doing the same thing for non-untagged images\r\n\t\tconst oSource = <Input>oEvent.getSource();\r\n\t\tconst oImage = <PImage>oSource.getBindingContext(\"untaggedImages\")!.getObject();\r\n\t\tconst oSelectedSuggestion = oEvent.getParameter('selectedRow');\r\n\t\tconst oSelectedPlant = <PPlant>oSelectedSuggestion.getBindingContext('plants').getObject();\r\n\t\tconst oImagesModel = this.oComponent.getModel('images');\r\n\t\tthis.imageEventHandlers.assignPlantToImage(oSelectedPlant, oImage, oImagesModel);\r\n\r\n\t\t(<JSONModel>this.getView().getModel('untaggedImages')).updateBindings(true);\r\n\t\toSource.setValue('');\r\n\t}\r\n\r\n\tonPressImagePlantToken(oEvent: Event){\r\n\t\t//navigate to chosen plant in plant details view when clicking on plant token in untagged images view\r\n\t\t//note: there's a same-named function in detail controller doing the same thing for non-untagged images\r\n\t\tconst oSource = <Token>oEvent.getSource();\r\n\t\tconst oPlantTag = <PImagePlantTag>oSource.getBindingContext('untaggedImages')!.getObject();\r\n\t\tif (!oPlantTag.plant_id || oPlantTag.plant_id <= 0) throw new Error(\"Unexpected error: No Plant ID\");\r\n\t\t\r\n\t\t//navigate to plant in layout's current column (i.e. middle column)\r\n\t\tNavigation.getInstance().navToPlant(this.getPlantById(oPlantTag.plant_id), this.oComponent);\r\n\t}\r\n\t\r\n\tonIconPressDeleteImage(oEvent: Event){\r\n\t\t//note: there's a same-named function in detail controller doing the same thing for non-untagged images\r\n\t\tconst oSource = <Icon>oEvent.getSource();\r\n\t\tconst oImage = <PImage>oSource.getBindingContext(\"untaggedImages\")!.getObject()\r\n\t\t\r\n\t\t//confirm dialog\r\n\t\tvar bCompact = !!this.getView().$().closest(\".sapUiSizeCompact\").length;\r\n\t\tMessageBox.confirm(\r\n\t\t\t\"Delete this image?\", {\r\n\t\t\t\ttitle: \"Delete\",\r\n\t\t\t\tonClose: this.confirmDeleteImage.bind(this, oImage),\r\n\t\t\t\tactions: ['Delete', 'Cancel'],\r\n\t\t\t\tstyleClass: bCompact ? \"sapUiSizeCompact\" : \"\"\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\t\r\n\tonInputImageNewKeywordSubmit(oEvent: Event){\r\n\t\t//note: there's a same-named function in detail controller doing the same thing for non-untagged images\r\n\t\tconst oInput = <Input>oEvent.getSource();\r\n\t\toInput.setValue('');\r\n\r\n\t\t// check not empty and new\r\n\t\tconst sKeyword = oEvent.getParameter('value').trim();\r\n\t\tif (!sKeyword){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst oImage = <PImage> oInput.getParent().getBindingContext('untaggedImages')!.getObject();\r\n\t\tlet aKeywords: PKeyword[] = oImage.keywords;\r\n\t\tif(aKeywords.find(ele=>ele.keyword === sKeyword)){\r\n\t\t\tMessageToast.show('Keyword already in list');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//add to current image keywords in untaggedImages model\r\n\t\taKeywords.push(<PKeyword>{\r\n\t\t\tkeyword: sKeyword\r\n\t\t});\r\n\r\n\t\tconst oImagesModel = this.oComponent.getModel('untaggedImages');\r\n\t\toImagesModel.updateBindings(false);\r\n\t}\r\n\r\n\tpublic onTokenizerTokenDelete(oEvent: Event){\r\n\t\t// triggered upon changes of image's plant assignments and image's keywords\r\n\t\t// note: the token itself has already been deleted; here, we only delete the \r\n\t\t// \t\t corresponding entry from the model\r\n\t\t//note: there's a same-named function in detail controller doing the same thing for non-untagged images\r\n\t\tif (oEvent.getParameter('type') !== 'removed')\r\n\t\t\treturn;\r\n\r\n\t\tconst sKey = oEvent.getParameter('token').getProperty('key');  //either plant name or keyword\r\n\t\tconst oTokenizer = <Tokenizer> oEvent.getSource();\r\n\t\tconst oImage = <PImage>oTokenizer.getParent()!.getBindingContext('untaggedImages')!.getObject();\r\n\t\tconst oModel = this.oComponent.getModel('untaggedImages');\r\n\t\tconst sType = oTokenizer.data('type'); // plant|keyword\r\n\r\n\t\tthis.imageEventHandlers.removeTokenFromModel(sKey, oImage, oModel, sType);\r\n\t}\r\n}"],"mappings":"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"}