sap.ui.define(["plants/ui/controller/BaseController","sap/m/MessageBox","plants/ui/model/formatter","plants/ui/model/ModelsHelper","plants/ui/customClasses/Util","sap/m/MessageToast","plants/ui/customClasses/ImageEventHandlers","../customClasses/Navigation"],function(e,t,n,o,s,a,i,g){function r(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const l=r(e);const c=r(n);const d=r(o);const u=r(i);const m=r(g);const h=l.extend("plants.ui.controller.Untagged",{constructor:function e(){l.prototype.constructor.apply(this,arguments);this.formatter=new c},onInit:function e(){l.prototype.onInit.call(this);this.oRouter.getRoute("untagged").attachPatternMatched(this._onPatternMatched,this);this.imageEventHandlers=new u(this.applyToFragment.bind(this));this.oComponent.getModel("status").setProperty("/untagged_selectable",false)},_onPatternMatched:function e(t){this._currentPlantId=parseInt(t.getParameter("arguments").plant_id||this._currentPlantId||"0");if(t.getParameter("name")!=="untagged"){return}},handleClose:function e(){var t=this.oComponent.getModel().getProperty("/actionButtonsInfo/endColumn/closeColumn");this.oRouter.navTo("detail",{layout:t,plant_id:this._currentPlantId})},onPressReApplyUntaggedFilter:function e(){this.oComponent.resetUntaggedPhotos()},onToggleSelectManyListMode:function e(t){const n=t.getSource();const o=n.getType();const s=this.byId("listImagesUntagged");const a=this.getView().getModel("status");if(o==="Transparent"){n.setType("Emphasized");s.setMode("MultiSelect");a.setProperty("/untagged_selectable",true)}else{n.setType("Transparent");s.setMode("None");a.setProperty("/untagged_selectable",false)}},onSelectNone:function e(t){this._resetSelection(this.byId("listImagesUntagged"))},_resetSelection:function e(t){t.getItems().forEach(function(e){e.setSelected(false)})},onSelectAll:function e(t){this.byId("listImagesUntagged").getItems().forEach(function(e){e.setSelected(true)})},onDeleteSelected:function e(n){const o=this.byId("listImagesUntagged");const s=o.getSelectedItems();const i=s.map(e=>e.getBindingContext("untaggedImages").getObject());if(s.length==0){a.show("Nothing selected.");return}var g=!!this.getView().$().closest(".sapUiSizeCompact").length;t.confirm("Delete "+s.length+" images?",{title:"Delete",onClose:this._confirmDeleteSelectedImages.bind(this,i),actions:["Delete","Cancel"],styleClass:g?"sapUiSizeCompact":""})},_confirmDeleteSelectedImages:function e(t,n){if(n!=="Delete"){return}$.ajax({url:s.getServiceUrl("images/"),type:"DELETE",contentType:"application/json",data:JSON.stringify({images:t}),context:this}).done(this.onAjaxDeletedImagesSuccess.bind(this,t,this.onSelectNone.bind(this))).fail(d.getInstance().onReceiveErrorGeneric.bind(this,"Images (DELETE)"))},onAddDetailsPlantToUntaggedImage:function e(t){const n=this.getPlantById(this._currentPlantId);const o=t.getSource().getParent().getBindingContext("untaggedImages");const s=o.getObject();const a=this.oComponent.getModel("images");this.imageEventHandlers.assignPlantToImage(n,s,a);this.getView().getModel("untaggedImages").updateBindings(true);this.resetImagesCurrentPlant(this._currentPlantId)},onAddPlantNameToUntaggedImage:function e(t){const n=t.getSource();const o=n.getBindingContext("untaggedImages").getObject();const s=t.getParameter("selectedRow");const a=s.getBindingContext("plants").getObject();const i=this.oComponent.getModel("images");this.imageEventHandlers.assignPlantToImage(a,o,i);this.getView().getModel("untaggedImages").updateBindings(true);n.setValue("")},onPressImagePlantToken:function e(t){const n=t.getSource();const o=n.getBindingContext("untaggedImages").getObject();if(!o.plant_id||o.plant_id<=0)throw new Error("Unexpected error: No Plant ID");m.getInstance().navToPlant(this.getPlantById(o.plant_id),this.oComponent)},onIconPressDeleteImage:function e(n){const o=n.getSource();const s=o.getBindingContext("untaggedImages").getObject();var a=!!this.getView().$().closest(".sapUiSizeCompact").length;t.confirm("Delete this image?",{title:"Delete",onClose:this.confirmDeleteImage.bind(this,s),actions:["Delete","Cancel"],styleClass:a?"sapUiSizeCompact":""})},onInputImageNewKeywordSubmit:function e(t){const n=t.getSource();n.setValue("");const o=t.getParameter("value").trim();if(!o){return}const s=n.getParent().getBindingContext("untaggedImages").getObject();let i=s.keywords;if(i.find(e=>e.keyword===o)){a.show("Keyword already in list");return}i.push({keyword:o});const g=this.oComponent.getModel("untaggedImages");g.updateBindings(false)},onTokenizerKeywordImageTokenDelete:function e(t){const n=t.getParameter("tokens");if(n.length>1)throw new Error("Unexpected error: More than one token to be deleted at once");const o=n[0];const s=o.getKey();const a=t.getSource();const i=a.getBindingContext("untaggedImages").getObject();const g=this.oComponent.getModel("untaggedImages");this.imageEventHandlers.removeKeywordImageTokenFromModel(s,i,g)},onTokenizerPlantImageTokenDelete:function e(t){const n=t.getParameter("tokens");if(n.length>1)throw new Error("Unexpected error: More than one token to be deleted at once");const o=n[0];const s=o.getKey();const a=t.getSource();const i=a.getBindingContext("untaggedImages").getObject();const g=this.oComponent.getModel("untaggedImages");this.imageEventHandlers.removePlantImageTokenFromModel(s,i,g)}});return h});