sap.ui.define(["plants/ui/controller/BaseController","sap/m/MessageBox","plants/ui/model/formatter","plants/ui/model/ModelsHelper","plants/ui/customClasses/Util","sap/m/MessageToast","plants/ui/customClasses/ImageEventHandlers","../customClasses/Navigation"],function(e,t,n,s,o,a,i,g){function l(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const r=l(e);const c=l(n);const d=l(s);const u=l(i);const m=l(g);const h=r.extend("plants.ui.controller.Untagged",{constructor:function e(){r.prototype.constructor.apply(this,arguments);this.formatter=new c},onInit:function e(){r.prototype.onInit.call(this);this.oRouter.getRoute("untagged").attachPatternMatched(this._onPatternMatched,this);this.imageEventHandlers=u.getInstance(this.applyToFragment.bind(this));this.oComponent.getModel("status").setProperty("/untagged_selectable",false)},_onPatternMatched:function e(t){this._currentPlantId=parseInt(t.getParameter("arguments").plant_id||this._currentPlantId||"0");if(t.getParameter("name")!=="untagged"){return}},handleClose:function e(){var t=this.oComponent.getModel().getProperty("/actionButtonsInfo/endColumn/closeColumn");this.oRouter.navTo("detail",{layout:t,plant_id:this._currentPlantId})},onPressReApplyUntaggedFilter:function e(){this.oComponent.resetUntaggedPhotos()},onToggleSelectManyListMode:function e(t){const n=t.getSource();const s=n.getType();const o=this.byId("listImagesUntagged");const a=this.getView().getModel("status");if(s==="Transparent"){n.setType("Emphasized");o.setMode("MultiSelect");a.setProperty("/untagged_selectable",true)}else{n.setType("Transparent");o.setMode("None");a.setProperty("/untagged_selectable",false)}},onSelectNone:function e(t){this._resetSelection(this.byId("listImagesUntagged"))},_resetSelection:function e(t){t.getItems().forEach(function(e){e.setSelected(false)})},onSelectAll:function e(t){this.byId("listImagesUntagged").getItems().forEach(function(e){e.setSelected(true)})},onDeleteSelected:function e(n){const s=this.byId("listImagesUntagged");const o=s.getSelectedItems();const i=o.map(e=>e.getBindingContext("untaggedImages").getObject());if(o.length==0){a.show("Nothing selected.");return}var g=!!this.getView().$().closest(".sapUiSizeCompact").length;t.confirm("Delete "+o.length+" images?",{title:"Delete",onClose:this._confirmDeleteSelectedImages.bind(this,i),actions:["Delete","Cancel"],styleClass:g?"sapUiSizeCompact":""})},_confirmDeleteSelectedImages:function e(t,n){if(n!=="Delete"){return}$.ajax({url:o.getServiceUrl("images/"),type:"DELETE",contentType:"application/json",data:JSON.stringify({images:t}),context:this}).done(this.onAjaxDeletedImagesSuccess.bind(this,t,this.onSelectNone.bind(this))).fail(d.getInstance().onReceiveErrorGeneric.bind(this,"Images (DELETE)"))},onAddDetailsPlantToUntaggedImage:function e(t){const n=this.getPlantById(this._currentPlantId);const s=t.getSource().getParent().getBindingContext("untaggedImages");const o=s.getObject();const a=this.oComponent.getModel("images");this.imageEventHandlers.assignPlantToImage(n,o,a);this.getView().getModel("untaggedImages").updateBindings(true);this.resetImagesCurrentPlant(this._currentPlantId)},onAddPlantNameToUntaggedImage:function e(t){const n=t.getSource();const s=n.getBindingContext("untaggedImages").getObject();const o=t.getParameter("selectedRow");const a=o.getBindingContext("plants").getObject();const i=this.oComponent.getModel("images");this.imageEventHandlers.assignPlantToImage(a,s,i);this.getView().getModel("untaggedImages").updateBindings(true);n.setValue("")},onPressImagePlantToken:function e(t){const n=t.getSource();const s=n.getBindingContext("untaggedImages").getObject();if(!s.plant_id||s.plant_id<=0)throw new Error("Unexpected error: No Plant ID");m.getInstance().navToPlant(this.getPlantById(s.plant_id),this.oComponent)},onIconPressDeleteImage:function e(n){const s=n.getSource();const o=s.getBindingContext("untaggedImages").getObject();var a=!!this.getView().$().closest(".sapUiSizeCompact").length;t.confirm("Delete this image?",{title:"Delete",onClose:this.confirmDeleteImage.bind(this,o),actions:["Delete","Cancel"],styleClass:a?"sapUiSizeCompact":""})},onInputImageNewKeywordSubmit:function e(t){const n=t.getSource();n.setValue("");const s=t.getParameter("value").trim();if(!s){return}const o=n.getParent().getBindingContext("untaggedImages").getObject();let i=o.keywords;if(i.find(e=>e.keyword===s)){a.show("Keyword already in list");return}i.push({keyword:s});const g=this.oComponent.getModel("untaggedImages");g.updateBindings(false)},onTokenizerTokenDelete:function e(t){if(t.getParameter("type")!=="removed")return;const n=t.getParameter("token").getProperty("key");const s=t.getSource();const o=s.getParent().getBindingContext("untaggedImages").getObject();const a=this.oComponent.getModel("untaggedImages");const i=s.data("type");this.imageEventHandlers.removeTokenFromModel(n,o,a,i)}});return h});