{"version":3,"file":"Detail.controller copy.js","names":["sap","ui","define","BaseController","JSONModel","Filter","formatter","MessageBox","MessageToast","Util","Navigation","MessageUtil","ModelsHelper","EventsUtil","Sorter","FilterOperator","ImageToTaxon","PropertiesUtil","ImageUtil","TraitUtil","TaxonomyUtil","extend","modelsHelper","getInstance","onInit","_oRouter","getOwnerComponent","getRouter","oLayoutModel","getModel","setProperty","getRoute","attachPatternMatched","_onPatternMatched","oEventsList","byId","bindAggregation","path","templateShareable","factory","eventsListFactory","bind","sorter","_oCurrentPlant","_currentPlantId","_currentPlantIndex","oEvent","startBusyDialog","parseInt","getParameter","plant_id","_bindModelsForCurrentPlant","oModelPlants","oPromise","dataLoaded","then","_bindPlantsModelDeferred","_loadBindEventsModel","imagesPlantsLoaded","has","requestImagesForPlant","resetImagesCurrentPlant","getView","bindElement","model","oEventsModel","getProperty","_loadEventsForCurrentPlant","aPlants","findIndex","plant","id","show","sPathCurrentPlant","parent_plant","undefined","plant_name","active","parent_plant_pollen","_bindTaxonOfCurrentPlantDeferred","_loadBindProperties","oModelProperties","loadPropertiesForCurrentPlant","uri","$","ajax","url","getServiceUrl","data","context","async","done","_onReceivingEventsForPlant","fail","onReceiveErrorGeneric","plantId","oData","sStatus","oReturnData","events","oEventsDataClone","getClonedObject","addMessageFromBackend","message","oPlant","taxon_id","handleFullScreen","sNextLayout","navTo","layout","handleExitFullScreen","handleClose","onChangeActiveSwitch","evt","oSwitch","getSource","applyToFragment","o","openBy","_initCancellationDialog","oDialog","setDateValue","Date","onIconPressSetPreview","sPathCurrentImage","getBindingContext","getPath","oCurrentImage","oCurrentPlant","sUrlOriginal","s","JSON","stringify","s2","substring","length","updateBindings","onSetInactive","aReasons","oReasonSelected","find","ele","selected","getObject","cancellation_reason","text","sDate","formatDate","getDateValue","cancellation_date","close","onChangeParent","console","log","mParameters","newValue","parentPlant","trim","parentalPlant","onPressGoToPlant","parentPlantId","navToPlantDetails","call","handleErrorMessageBox","onSuggestNursery","aFilters","sTerm","push","Contains","getBinding","filter","setFilterSuggests","onPressButtonDeletePlant","sPlant","oBindingContextPlants","bCompact","closest","confirm","icon","Icon","WARNING","title","stretch","onClose","_confirmDeletePlant","actions","styleClass","onPressButtonClonePlant","aModifiedPlants","getModifiedPlants","aModifiedImages","getModifiedImages","aModifiedTaxa","getModifiedTaxa","clonePlantName","_generatePlantNameWithRomanizedSuffix","setValue","open","sAction","type","contentType","_onPlantDeleted","oMsg","stopBusyDialog","onAjaxSimpleSuccess","aPlantsData","getData","PlantsCollection","iPosition","indexOf","splice","refresh","aPlantsDataClone","oPlantsDataClone","oPlantClone","element","onToggleEditMode","sCurrentType","getType","setType","onPressTag","oTag","sPathTag","pressDeleteTag","oContext","sPathItem","iIndex","substr","lastIndexOf","tags","onOpenAddTagDialog","oButton","_initTagDialog","dObjectStatusSelection","ObjectStatusCollection","Value","oTagTypesModel","setModel","onAddTag","dDialogData","oSelectedElement","bFound","dNewTag","state","onPressButtonRenamePlant","onLiveChangeNewPlantName","sText","setEnabled","onPressButtonSubmitClonePlant","sClonedPlantName","getValue","isPlantNameInPlantsModel","_onReceivingPlantCloned","oPlantSaved","plants","onPressButtonSubmitRenamePlant","sNewPlantName","dPayload","_onReceivingPlantNameRenamed","oModelsHelper","reloadPlantsFromBackend","resetImagesRegistry","reloadTaxaFromBackend","sId","encodeURIComponent","_onReceivingImagesForPlant","addPhotosToRegistry","add","onUploadPlantPhotosToServer","oFileUploader","sPath","sUrl","setUploadUrl","upload","handleUploadPlantImagesComplete","oResponse","parse","sMsg","addMessage","images","addToImagesRegistry","onPressButtonCreateDescendantPlant","defaultPropagationType","descendantPlantDataInit","getPlantById","modelDescendant","updatePlantNameSuggestion","onDescendantDialogCreate","descendantPlantData","propagationType","getSuggestionItem","hasParentPlantPollen","parentPlantPollen","descendantPlantName","getPlantByName","newPlant","field_number","geographic_origin","oParentPlantPollen","saveNewPlant","baseName","beginWith","i","latinNumber","romanize","suggestedName","_generateNewPlantNameSuggestion","parentPlantName","parentPlantPollenName","includeParentPlantPollen","botanical_name","reRomanNumber","romanNumberMatch","match","romanNumber","pop","arabize","getSelected","onDescendantDialogChangeParent","event","parentType","onDescendantDialogSwitchParents","onSwitchImageEditDescription"],"sources":["../../src/controller/Detail.controller copy.js"],"sourcesContent":["sap.ui.define([\r\n\t\"plants/ui/customClasses/BaseController\",\r\n\t\"sap/ui/model/json/JSONModel\",\r\n\t'sap/ui/model/Filter',\r\n\t'plants/ui/model/formatter',\r\n\t'sap/m/MessageBox',\r\n\t\"sap/m/MessageToast\",\r\n\t\"plants/ui/customClasses/Util\",\r\n\t\"plants/ui/customClasses/Navigation\",\r\n\t\"plants/ui/customClasses/MessageUtil\",\r\n\t\"plants/ui/model/ModelsHelper\",\r\n\t\"plants/ui/customClasses/EventsUtil\",\r\n\t\"sap/ui/model/Sorter\",\r\n\t\"sap/ui/model/FilterOperator\",\r\n    \"plants/ui/customClasses/ImageToTaxon\",\r\n    \"plants/ui/customClasses/PropertiesUtil\",\r\n\t\"plants/ui/customClasses/ImageUtil\",\r\n\t\"plants/ui/customClasses/TraitUtil\",\r\n\t\"plants/ui/customClasses/TaxonomyUtil\",\r\n], function (BaseController, JSONModel, Filter, formatter, \r\n\t\t\tMessageBox, MessageToast, Util, Navigation, MessageUtil, ModelsHelper, \r\n\t\t\tEventsUtil, Sorter, FilterOperator,\r\n\t\t\tImageToTaxon, PropertiesUtil, ImageUtil, TraitUtil, TaxonomyUtil) {\r\n\t\"use strict\";\r\n\t\r\n\treturn BaseController.extend(\"plants.ui.controller.Detail\", {\r\n\t\t// container for xml view control event handlers\r\n\t\tformatter: formatter,\r\n\t\tEventsUtil: EventsUtil,\r\n\t\tPropertiesUtil: PropertiesUtil,\r\n\t\tImageToTaxon: ImageToTaxon,\r\n\r\n\t\t// helper classes for controllers\r\n\t\tmodelsHelper: ModelsHelper.getInstance(),\r\n\t\tImageUtil: ImageUtil.getInstance(),\r\n\t\tTraitUtil: TraitUtil.getInstance(),\r\n\t\tTaxonomyUtil: TaxonomyUtil.getInstance(),\r\n\r\n\t\tonInit: function () {\r\n\t\t\tthis._oRouter = this.getOwnerComponent().getRouter();\r\n\t\t\tthis.oLayoutModel = this.getOwnerComponent().getModel();\r\n\t\t\t\r\n\t\t\t// default: view mode for plants information\r\n\t\t\tthis.getOwnerComponent().getModel('status').setProperty('/details_editable', false);\r\n\t\t\t\r\n\t\t\t// this._oRouter.getRoute(\"master\").attachPatternMatched(this._onPatternMatched, this);\r\n\t\t\tthis._oRouter.getRoute(\"detail\").attachPatternMatched(this._onPatternMatched, this);\r\n\t\t\tthis._oRouter.getRoute(\"untagged\").attachPatternMatched(this._onPatternMatched, this);\r\n\t\t\t\r\n\t\t\t// bind factory function to events list aggregation binding\r\n    \t\tvar oEventsList = this.byId(\"eventsList\");\r\n    \t\toEventsList.bindAggregation(\"items\", \r\n    \t\t\t{\tpath: \"events>\", \r\n    \t\t\t\ttemplateShareable: false,\r\n    \t\t\t\tfactory: this.EventsUtil.eventsListFactory.bind(this),\r\n    \t\t\t\tsorter: new Sorter('date', true)  // descending by date\r\n    \t\t\t});\r\n\t\t\t\r\n\t\t\tthis._oCurrentPlant = null;\r\n\t\t\tthis._currentPlantId = null;\r\n\t\t\tthis._currentPlantIndex = null;\r\n\r\n\t\t\tthis.getOwnerComponent().getModel('status').setProperty('/images_editable', false);\r\n\t\t},\r\n\r\n\t\t_onPatternMatched: function (oEvent) {\r\n\t\t\t// if accessed directly, we might not have loaded the plants model, yet\r\n\t\t\t// in that case, we have the plant_id, but not the position of that plant\r\n\t\t\t// in the plants model index. so we must defer binding that plant to the view\r\n\r\n\t\t\tUtil.startBusyDialog();\r\n\r\n\t\t\t//bind taxon of current plant and events to view (deferred as we may not know the plant name here, yet)\r\n\t\t\tthis._currentPlantId = parseInt(oEvent.getParameter(\"arguments\").plant_id || this.plant_id || \"0\");\r\n\t\t\tthis._bindModelsForCurrentPlant();\r\n\r\n\t\t\t//unbind events data (to avoid events from previous plants being shown)\r\n\t\t\t// this.getView().unbindElement('events');\t\t\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_bindModelsForCurrentPlant: function(){\r\n\t\t\t//we need to set the taxon deferred as well as we might not have the taxon_id, yet\r\n\t\t\t//we need to wait for the plants model to be loaded\r\n\t\t\t//same applies to the events model which requires the plant_id\r\n\t\t\tvar oModelPlants = this.getOwnerComponent().getModel('plants');\r\n\t\t\tvar oPromise = oModelPlants.dataLoaded();\r\n\t\t\toPromise.then(this._bindPlantsModelDeferred.bind(this), \r\n\t\t\t\t\t\t  this._bindPlantsModelDeferred.bind(this));\r\n\t\t\t\r\n\t\t\t//loading and binding events requires only the plant id\r\n\t\t\tthis._loadBindEventsModel();\r\n\r\n\t\t\t// if we haven't loaded images for this plant, yet, we do so before generating the images model\r\n\t\t\tif (!this.getOwnerComponent().imagesPlantsLoaded.has(this._currentPlantId)){\r\n\t\t\t\tthis.requestImagesForPlant(this._currentPlantId);\r\n\t\t\t} else {\r\n\t\t\t\tthis.resetImagesCurrentPlant(this._currentPlantId);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_loadBindEventsModel: function(){\r\n\t\t\t//load and bind events\r\n\t\t\t//bind current view to that property in events model\r\n\t\t\tthis.getView().bindElement({\r\n\t\t\t\tpath: \"/PlantsEventsDict/\" + this._currentPlantId,\r\n\t\t\t\tmodel: \"events\"\r\n\t\t\t});\t\t\r\n\r\n\t\t\t//load only on first load of that plant, otherwise we would overwrite modifications\r\n\t\t\t//to the plant's events\r\n\t\t\tvar oEventsModel = this.getOwnerComponent().getModel('events');\r\n\t\t\tif(!oEventsModel.getProperty('/PlantsEventsDict/'+this._currentPlantId+'/')){\r\n\t\t\t\tthis._loadEventsForCurrentPlant();\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t_bindPlantsModelDeferred: function(){\r\n\t\t\t//triggered upon data loading finished of plants model, i.e. we now have the taxon_id, plant_name,\r\n\t\t\t// position of plant_id in the plants model array, etc.\r\n\r\n\t\t\t// get current plant's position in plants model array\r\n\t\t\tvar aPlants = this.getOwnerComponent().getModel('plants').getProperty('/PlantsCollection');\r\n\t\t\tthis._currentPlantIndex = aPlants.findIndex(plant=>plant.id === this._currentPlantId);\r\n\t\t\tif(this._currentPlantIndex === -1){\r\n\t\t\t\tMessageToast.show('Plant ID '+ this._currentPlantId +' not found. Redirecting.');\r\n\t\t\t\tthis._currentPlantIndex = 0;\r\n\t\t\t}\r\n\r\n\t\t\t// get current plant object in plants model array and bind plant to details view\r\n\t\t\tvar sPathCurrentPlant = \"/PlantsCollection/\" + this._currentPlantIndex;\r\n\t\t\tthis._oCurrentPlant = this.getOwnerComponent().getModel('plants').getProperty(sPathCurrentPlant);\r\n\t\t\tif (!this._oCurrentPlant.parent_plant){\r\n\t\t\t\tthis._oCurrentPlant.parent_plant = {\r\n\t\t\t\t\tid: undefined,\r\n\t\t\t\t\tplant_name: undefined,\r\n\t\t\t\t\tactive: undefined\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!this._oCurrentPlant.parent_plant_pollen){\r\n\t\t\t\tthis._oCurrentPlant.parent_plant_pollen = {\r\n\t\t\t\t\tid: undefined,\r\n\t\t\t\t\tplant_name: undefined,\r\n\t\t\t\t\tactive: undefined\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.getView().bindElement({\r\n\t\t\t\tpath: sPathCurrentPlant,\r\n\t\t\t\tmodel: \"plants\"\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//bind taxon\r\n\t\t\tthis._bindTaxonOfCurrentPlantDeferred(this._oCurrentPlant);\r\n\t\t\t\r\n\t\t\t// treat properties model in the same way (it requires the taxon to be known so we have\r\n\t\t\t// to load it here)\r\n\t\t\tthis._loadBindProperties()\r\n\r\n\t\t},\r\n\r\n\t\t_loadBindProperties: function(){\r\n\t\t\tthis.getView().bindElement({\r\n\t\t\t\tpath: \"/propertiesPlants/\" + this._oCurrentPlant.id,\r\n\t\t\t\tmodel: \"properties\"\r\n\t\t\t});\r\n\t\t\tvar oModelProperties = this.getOwnerComponent().getModel('properties');\r\n\t\t\tif(!oModelProperties.getProperty('/propertiesPlants/'+this._oCurrentPlant.id+'/')){\r\n\t\t\t\tPropertiesUtil.loadPropertiesForCurrentPlant(this._oCurrentPlant, this.getOwnerComponent());\r\n\t\t\t} \t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_loadEventsForCurrentPlant: function(){\r\n\t\t\t// request data from backend\r\n\t\t\t// data is added to local events model and bound to current view upon receivement\r\n\t\t\tvar uri = 'events/'+this._currentPlantId;\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: Util.getServiceUrl(uri),\r\n\t\t\t\tdata: {},\r\n\t\t\t\tcontext: this,\r\n\t\t\t\tasync: true\r\n\t\t\t})\r\n\t\t\t.done(this._onReceivingEventsForPlant.bind(this, this._currentPlantId))\r\n\t\t\t.fail(this.ModelsHelper.getInstance().onReceiveErrorGeneric.bind(this,'Event (GET)'))\r\n\t\t},\r\n\r\n\t\t_onReceivingEventsForPlant: function(plantId, oData, sStatus, oReturnData){\r\n\t\t\t//insert (overwrite!) events data for current plant with data received from backend\r\n\t\t\tvar oEventsModel = this.getOwnerComponent().getModel('events');\r\n\t\t\toEventsModel.setProperty('/PlantsEventsDict/'+plantId+'/', oData.events);\r\n\t\t\t// oEventsModel.setProperty('/PlantsEventsDict/'+this._currentPlantIndex+'/', oData.events);\r\n\t\t\t\r\n\t\t\t//for tracking changes, save a clone\r\n\t\t\tif (!this.getOwnerComponent().oEventsDataClone){\r\n\t\t\t\tthis.getOwnerComponent().oEventsDataClone = {};\r\n\t\t\t}\r\n\t\t\tthis.getOwnerComponent().oEventsDataClone[plantId] = Util.getClonedObject(oData.events);\r\n\t\t\tMessageUtil.getInstance().addMessageFromBackend(oData.message);\r\n\t\t},\r\n\t\t\r\n\t\t_bindTaxonOfCurrentPlantDeferred: function(oPlant){\r\n\t\t\tthis.getView().bindElement({\r\n\t\t\t\tpath: \"/TaxaDict/\" + oPlant.taxon_id,\r\n\t\t\t\tmodel: \"taxon\"\r\n\t\t\t});\t\t\t\t\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\thandleFullScreen: function () {\r\n\t\t\tvar sNextLayout = this.oLayoutModel.getProperty(\"/actionButtonsInfo/midColumn/fullScreen\");\r\n\t\t\tthis._oRouter.navTo(\"detail\", {layout: sNextLayout, plant_id: this._oCurrentPlant.id});\r\n\t\t},\r\n\t\thandleExitFullScreen: function () {\r\n\t\t\tvar sNextLayout = this.oLayoutModel.getProperty(\"/actionButtonsInfo/midColumn/exitFullScreen\");\r\n\t\t\tthis._oRouter.navTo(\"detail\", {layout: sNextLayout, plant_id: this._oCurrentPlant.id});\r\n\t\t},\r\n\t\thandleClose: function () {\r\n\t\t\tvar sNextLayout = this.oLayoutModel.getProperty(\"/actionButtonsInfo/midColumn/closeColumn\");\r\n\t\t\tthis._oRouter.navTo(\"master\", {layout: sNextLayout});\r\n\t\t},\r\n\r\n\t\tonChangeActiveSwitch: function(evt){\r\n\t\t\tif (!evt.getParameter('state')){\r\n\t\t\t\tvar oSwitch = evt.getSource();\r\n\t\t\t\tthis.applyToFragment(\r\n\t\t\t\t\t'dialogCancellation',\r\n\t\t\t\t\t(o)=>o.openBy(oSwitch),\r\n\t\t\t\t\t_initCancellationDialog.bind(this));\r\n\r\n\t\t\t\tfunction _initCancellationDialog(oDialog){\r\n\t\t\t\t\t// set current date as default\r\n\t\t\t\t\tthis.getView().byId(\"cancellationDate\").setDateValue( new Date());\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonIconPressSetPreview: function(evt){\r\n\t\t\t// get selected image and current plant in model\r\n\t\t\tvar sPathCurrentImage = evt.getSource().getBindingContext(\"images\").getPath();\r\n\t\t\tvar oCurrentImage = this.getOwnerComponent().getModel('images').getProperty(sPathCurrentImage);\r\n\t\t\tvar sPathCurrentPlant = evt.getSource().getBindingContext(\"plants\").getPath();\r\n\t\t\tvar oCurrentPlant = this.getOwnerComponent().getModel('plants').getProperty(sPathCurrentPlant);\r\n\t\t\t\r\n\t\t\t// temporarily set original image as preview image\r\n\t\t\t// upon reloading plants model, a specific preview image will be generated \r\n\t\t\tvar sUrlOriginal = oCurrentImage['filename'];\r\n\t\t\tvar s = JSON.stringify(sUrlOriginal); // model stores backslash unescaped, so we need a workaround\r\n\t\t\tvar s2 = s.substring(1, s.length-1);\r\n\t\t\toCurrentPlant['url_preview'] = s2;\r\n\t\t\toCurrentPlant['filename_previewimage'] = oCurrentImage['filename'];\r\n\t\t\t\r\n\t\t\tthis.getOwnerComponent().getModel('plants').updateBindings();\r\n\t\t},\r\n\t\t\r\n\t\tonSetInactive: function(evt){\r\n\t\t\t//we don't use radiobuttongroup helper, so we must get selected element manually\r\n\t\t\tvar aReasons = this.getOwnerComponent().getModel('suggestions').getProperty('/cancellationReasonCollection');\r\n\t\t\tvar oReasonSelected = aReasons.find(ele=>ele.selected);\r\n\r\n\t\t\t//set current plant's cancellation reason and date\r\n\t\t\tthis.getView().getBindingContext('plants').getObject().cancellation_reason = oReasonSelected.text;\r\n\t\t\tvar sDate = Util.formatDate(this.byId(\"cancellationDate\").getDateValue());\r\n\t\t\tthis.getView().getBindingContext('plants').getObject().cancellation_date = sDate;\r\n\t\t\tthis.getOwnerComponent().getModel('plants').updateBindings();\r\n\r\n\t\t\tthis.byId('dialogCancellation').close();\r\n\t\t},\r\n\r\n\t\tonChangeParent: function(oEvent){\r\n\t\t\tconsole.log(oEvent.mParameters.newValue);\r\n\t\t\t// verify entered parent and set parent plant id\r\n\t\t\tvar aPlants = this.getView().getModel('plants').getProperty('/PlantsCollection');\r\n\t\t\tvar parentPlant = aPlants.find(plant=>plant.plant_name === oEvent.getParameter('newValue').trim());\r\n\t\t\t\r\n\t\t\tif (!oEvent.getParameter('newValue').trim() || !parentPlant){\r\n\t\t\t\t// delete parent plant\r\n\t\t\t\tvar parentalPlant = {\r\n\t\t\t\t\tid: undefined,\r\n\t\t\t\t\tplant_name: undefined,\r\n\t\t\t\t\tactive: undefined\r\n\t\t\t\t}\r\n\t\t\t\t// oEvent.getSource().setValue(undefined);\r\n\t\t\t\t// var parentPlantName = undefined;\r\n\t\t\t\t// var parentPlantId = undefined;\r\n\t\t\t\t// var parentPlantActive = undefined;\r\n\t\t\t} else {\r\n\t\t\t\t// set parent plant\r\n\t\t\t\tparentalPlant = {\r\n\t\t\t\t\tid: parentPlant.id, \r\n\t\t\t\t\tplant_name: parentPlant.plant_name, \r\n\t\t\t\t\tactive: parentPlant.active\r\n\t\t\t\t}\r\n\t\t\t\t// oEvent.getSource().setValue(parentPlant.plant_name);\r\n\t\t\t\t// parentPlantName = parentPlant.plant_name;\r\n\t\t\t\t// parentPlantId = parentPlant.id;\r\n\t\t\t\t// parentPlantActive = parentPlant.active;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// fn is fired by changes for parent and parent_ollen\r\n\t\t\tif (oEvent.getSource().data('parentType') === \"parent_pollen\"){\r\n\t\t\t\t// this._oCurrentPlant.parent_plant_pollen = parentPlantName;\r\n\t\t\t\t// this._oCurrentPlant.parent_plant_pollen_id = parentPlantId;\r\n\t\t\t\tthis._oCurrentPlant.parent_plant_pollen = parentalPlant;\r\n\t\t\t} else {\r\n\t\t\t\t// this._oCurrentPlant.parent_plant = parentPlantName;\r\n\t\t\t\t// this._oCurrentPlant.parent_plant_id = parentPlantId;\r\n\t\t\t\tthis._oCurrentPlant.parent_plant = parentalPlant;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonPressGoToPlant: function(parentPlantId){\r\n\t\t\t//navigate to supplied plant\r\n\t\t\tif (!!parentPlantId){\r\n\t\t\t\tNavigation.navToPlantDetails.call(this, parentPlantId);\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tthis.handleErrorMessageBox(\"Can't determine Plant Index\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonSuggestNursery: function(evt){\r\n\t\t\t// overwrite default suggestions (only beginsWith term) with custom one (contains term))\r\n\t\t    var aFilters = [];\r\n\t\t    var sTerm = evt.getParameter(\"suggestValue\");\r\n\t\t    if (sTerm) {\r\n\t\t        aFilters.push(new Filter(\"name\", FilterOperator.Contains, sTerm));\r\n\t\t    }\r\n\t\t    evt.getSource().getBinding(\"suggestionItems\").filter(aFilters);\r\n\t\t    //do <<not>> filter the provided suggestions with default logic before showing them to the user\r\n\t\t    evt.getSource().setFilterSuggests(false);\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\tonPressButtonDeletePlant: function(evt, sPlant, plantId){\r\n\t\t\tif(sPlant.length < 1){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//confirm dialog\r\n\t\t\tvar oBindingContextPlants = evt.getSource().getBindingContext('plants');\r\n\t\t\tvar bCompact = !!this.getView().$().closest(\".sapUiSizeCompact\").length;\r\n\t\t\tMessageBox.confirm(\r\n\t\t\t\t\"Delete plant \"+sPlant+\"?\", {\r\n\t\t\t\t\ticon: MessageBox.Icon.WARNING,\r\n\t\t\t\t\ttitle: \"Delete\",\r\n\t\t\t\t\tstretch: false,\r\n\t\t\t\t\tonClose: this._confirmDeletePlant.bind(this, sPlant, plantId, oBindingContextPlants),\r\n\t\t\t\t\tactions: ['Delete', 'Cancel'],\r\n\t\t\t\t\tstyleClass: bCompact ? \"sapUiSizeCompact\" : \"\"\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tonPressButtonClonePlant: function(oEvent){\r\n\t\t\t// triggered by button in details upper menu\r\n\t\t\t// opens dialog to clone current plant\r\n\t\t\t\r\n\t\t\t// check if there are any unsaved changes\r\n\t\t\tvar aModifiedPlants = this.getModifiedPlants();\r\n\t\t\tvar aModifiedImages = this.getModifiedImages();\r\n\t\t\tvar aModifiedTaxa = this.getModifiedTaxa();\r\n\t\t\tif((aModifiedPlants.length !== 0)||(aModifiedImages.length !== 0)||(aModifiedTaxa.length !== 0)){\r\n\t\t\t\tMessageToast.show('There are unsaved changes. Save modified data or reload data first.');\r\n\t\t\t\treturn;\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.applyToFragment('dialogClonePlant',(o)=>{\r\n\t\t\t\tvar clonePlantName = this._generatePlantNameWithRomanizedSuffix(this._oCurrentPlant.plant_name, 2);\r\n\t\t\t\tthis.byId('inputClonedPlantName').setValue(clonePlantName);\r\n\t\t\t\to.open();\r\n\t\t\t});\t\t\r\n\t\t},\r\n\t\t\t\r\n\t\t_confirmDeletePlant: function(sPlant, plantId, oBindingContextPlants, sAction){\r\n\t\t\tif(sAction !== 'Delete'){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tUtil.startBusyDialog('Deleting', 'Deleting '+sPlant);\r\n\t\t\t$.ajax({\r\n\t\t\t\t\t  url: Util.getServiceUrl('plants/'),\r\n\t\t\t\t\t  type: 'DELETE',\r\n\t\t\t\t\t  contentType: \"application/json\",\r\n\t\t\t\t\t  data: JSON.stringify({'plant_id': plantId}),\r\n\t\t\t\t\t  context: this\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.done(this._onPlantDeleted.bind(this, oBindingContextPlants))\r\n\t\t\t\t\t.fail(ModelsHelper.getInstance().onReceiveErrorGeneric.bind(this,'Plant (DELETE)'));\r\n\t\t},\r\n\t\t\r\n\t\t_onPlantDeleted: function(oBindingContextPlants, oMsg, sStatus, oReturnData){\r\n\t\t\t\tUtil.stopBusyDialog();\r\n\t\t\t\tthis.onAjaxSimpleSuccess(oMsg, sStatus, oReturnData);\r\n\t\t\t\t\r\n\t\t\t\t//remove from plants model and plants model clone\r\n\t\t\t\t//find deleted image in model and remove there\r\n\t\t\t\tvar aPlantsData = this.getView().getModel('plants').getData().PlantsCollection;\r\n\t\t\t\tvar oPlant = oBindingContextPlants.getProperty();\r\n\t\t\t\tvar iPosition = aPlantsData.indexOf(oPlant);\r\n\t\t\t\taPlantsData.splice(iPosition, 1);\r\n\t\t\t\tthis.getView().getModel('plants').refresh();\r\n\t\t\t\t\r\n\t\t\t\t//delete from model clone (used for tracking changes) as well\r\n\t\t\t\tvar aPlantsDataClone = this.getOwnerComponent().oPlantsDataClone.PlantsCollection;\r\n\t\t\t\t//can't find position with object from above\r\n\t\t\t\tvar oPlantClone = aPlantsDataClone.find(function(element){ \r\n\t\t\t\t\treturn element.plant_name === oPlant.plant_name; \r\n\t\t\t\t});\r\n\t\t\t\tif(oPlantClone !== undefined){\r\n\t\t\t\t\taPlantsDataClone.splice(aPlantsDataClone.indexOf(oPlantClone), 1);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//return to one-column-layout (plant in details view was deleted)\r\n\t\t\t\tthis.handleClose();\r\n\t\t},\r\n\r\n\t\tonToggleEditMode: function(evt){\r\n\t\t\t// toggle edit mode for some of the input controls (actually hide the read-only ones and \r\n\t\t\t// unhide the others)\r\n\t\t\tvar sCurrentType = evt.getSource().getType();\r\n\t\t\tif(sCurrentType === 'Transparent'){\r\n\t\t\t\t// set edit mode\r\n\t\t\t\tevt.getSource().setType('Emphasized');\r\n\t\t\t\tthis.getView().getModel('status').setProperty('/details_editable', true);\r\n\t\t\t} else {\r\n\t\t\t\t// set view mode (default)\r\n\t\t\t\tevt.getSource().setType('Transparent');\r\n\t\t\t\tthis.getView().getModel('status').setProperty('/details_editable', false);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonPressTag: function(evt){\r\n\t\t\t// create delete dialog for tags\r\n\t\t\tvar oTag = evt.getSource();  // for closure\r\n\t\t\tvar sPathTag = oTag.getBindingContext('plants').getPath();\r\n\r\n\t\t\tthis.applyToFragment('menuDeleteTag', (o)=>{\r\n\t\t\t\to.bindElement({ path: sPathTag,\r\n\t\t\t\t\t\t\t\tmodel: \"plants\" });\t\t\t\t\r\n\t\t\t\to.openBy(oTag);\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\tpressDeleteTag: function(evt){\r\n\t\t\tvar oContext = evt.getSource().getBindingContext('plants');\r\n\t\t\t// get position in tags array\r\n\t\t\tvar sPathItem = oContext.getPath();\r\n\t\t\tvar iIndex = sPathItem.substr(sPathItem.lastIndexOf('/')+1);\r\n\t\t\t// remove item from array\r\n\t\t\tthis.getOwnerComponent().getModel('plants').getData().PlantsCollection[this._currentPlantIndex].tags.splice(iIndex, 1);\r\n\t\t\tthis.getOwnerComponent().getModel('plants').refresh();\r\n\t\t},\r\n\t\t\r\n\t\tonOpenAddTagDialog: function(evt){\r\n\t\t\t// create add tag dialog\r\n\t\t\tvar oButton = evt.getSource();\r\n\r\n\t\t\tthis.applyToFragment(\r\n\t\t\t\t'dialogAddTag',\r\n\t\t\t\t(o)=>o.openBy(oButton),\r\n\t\t\t\t_initTagDialog.bind(this));\r\n\t\t\tfunction _initTagDialog(oDialog){\r\n\t\t\t\tvar dObjectStatusSelection = {ObjectStatusCollection: [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{'selected': false, 'text': 'None', 'state': 'None'},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{'selected': false, 'text': 'Indication01', 'state': 'Indication01'},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{'selected': false, 'text': 'Success', 'state': 'Success'},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{'selected': true, 'text': 'Information', 'state': 'Information'},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{'selected': false, 'text': 'Error', 'state': 'Error'},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{'selected': false, 'text': 'Warning', 'state': 'Warning'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\t\tValue: ''\r\n\t\t\t\t};\r\n\t\t\t\tvar oTagTypesModel = new JSONModel(dObjectStatusSelection);\r\n\t\t\t\toDialog.setModel(oTagTypesModel, 'tagTypes');\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tonAddTag: function(evt){\r\n\t\t\t// create a new tag inside the plant's object in the plants model\r\n\t\t\t// it will be saved in backend when saving the plant\r\n\t\t\t// new/deleted tags are within scope of the plants model modification tracking\r\n\t\t\tvar dDialogData = this.byId('dialogAddTag').getModel('tagTypes').getData();\r\n\t\t\tdDialogData.Value = dDialogData.Value.trim();\r\n\t\t\t\r\n\t\t\t// check if empty \r\n\t\t\tif(dDialogData.Value.length === 0){\r\n\t\t\t\tMessageToast.show('Enter text first.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// get selected ObjectStatus template\r\n\t\t\tvar oSelectedElement = dDialogData.ObjectStatusCollection.find(function(element) {\r\n\t\t\t\treturn element.selected;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// check if same-text tag already exists for plant\r\n\t\t\tvar oPlant = this.getOwnerComponent().getModel('plants').getData().PlantsCollection[this._currentPlantIndex]; \r\n\t\t\tif(oPlant.tags){\r\n\t\t\t\tvar bFound = oPlant.tags.find(function(oTag){\r\n\t\t\t\t\treturn oTag.text === dDialogData.Value;\t\r\n\t\t\t\t});\r\n\t\t\t\tif(bFound){\r\n\t\t\t\t\tMessageToast.show('Tag already exists.');\r\n\t\t\t\t\treturn;\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// create new token object in plants model\r\n\t\t\tvar dNewTag = {\r\n\t\t\t\t\t\t\t\t// id is determined upon saving to db\r\n\t\t\t\t\t\t\t\ttext: dDialogData.Value,\r\n\t\t\t\t\t\t\t\t// icon: oSelectedElement.icon,\r\n\t\t\t\t\t\t\t\tstate: oSelectedElement.state,\r\n\t\t\t\t\t\t\t\t// last_update is determined upon saving to db\r\n\t\t\t\t\t\t\t\t// plant_name: oPlant.plant_name,\r\n\t\t\t\t\t\t\t\tplant_id: oPlant.id\r\n\t\t\t\t\t\t\t};\r\n\t\t\tif (oPlant.tags){\r\n\t\t\t\toPlant.tags.push(dNewTag);\t\r\n\t\t\t} else {\r\n\t\t\t\toPlant.tags = [dNewTag];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.getOwnerComponent().getModel('plants').updateBindings();\r\n\t\t\tthis.byId('dialogAddTag').close();\r\n\t\t},\r\n\t\t\r\n\t\tonPressButtonRenamePlant: function(oEvent){\r\n\t\t\t// triggered by button in details upper menu\r\n\t\t\t// opens dialog to rename current plant\r\n\t\t\t\r\n\t\t\t// check if there are any unsaved changes\r\n\t\t\tvar aModifiedPlants = this.getModifiedPlants();\r\n\t\t\tvar aModifiedImages = this.getModifiedImages();\r\n\t\t\tvar aModifiedTaxa = this.getModifiedTaxa();\r\n\t\t\tif((aModifiedPlants.length !== 0)||(aModifiedImages.length !== 0)||(aModifiedTaxa.length !== 0)){\r\n\t\t\t\tMessageToast.show('There are unsaved changes. Save modified data or reload data first.');\r\n\t\t\t\treturn;\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.applyToFragment('dialogRenamePlant',(o)=>{\r\n\t\t\t\tthis.byId('inputNewPlantName').setValue(this._oCurrentPlant.plant_name);\r\n\t\t\t\to.open();\r\n\t\t\t});\t\t\r\n\t\t},\r\n\r\n\t\tonLiveChangeNewPlantName: function(evt, type){\r\n\t\t\t// called from either rename or clone fragment\r\n\t\t\tvar sText = evt.getParameter('value');\r\n\t\t\tif (type === 'clone'){\r\n\t\t\t\tthis.byId('btnClonePlantSubmit').setEnabled(sText.length > 0);\t\t\r\n\t\t\t} else if (type === 'rename'){\r\n\t\t\t\tthis.byId('btnRenamePlantSubmit').setEnabled(sText.length > 0);\t\t\r\n\t\t\t} else if (type === 'descendant'){\r\n\t\t\t\tthis.byId('btnDescendantDialogCreate').setEnabled(sText.length > 0);\t\t\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonPressButtonSubmitClonePlant: function(oEvent){\r\n\t\t\t// use ajax to clone plant in backend\r\n\t\t\tvar sClonedPlantName = this.byId('inputClonedPlantName').getValue().trim();\r\n\t\t\t\r\n\t\t\t// check if duplicate\r\n\t\t\tif (sClonedPlantName === ''){\r\n\t\t\t\tMessageToast.show('Empty not allowed.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//check if new\r\n\t\t\tif(this.isPlantNameInPlantsModel(sClonedPlantName)){\r\n\t\t\t\tMessageToast.show('Plant Name already exists.');\r\n\t\t\t\treturn;\r\n\t\t\t}\t\t\t\r\n\r\n\t\t\t// ajax call\r\n\t\t\tUtil.startBusyDialog(\"Cloning...\", '\"'+this._oCurrentPlant.plant_name+'\" to \"'+sClonedPlantName+'\"');\r\n\t    \t$.ajax({\r\n\t\t\t\t  url: Util.getServiceUrl('plants/'+this._oCurrentPlant.id+'/clone?plant_name_clone='+sClonedPlantName),\r\n\t\t\t\t  type: 'POST',\r\n\t\t\t\t  contentType: \"application/json\",\r\n\t\t\t\t  context: this\r\n\t\t\t\t})\r\n\t\t\t\t.done(this._onReceivingPlantCloned)\r\n\t\t\t\t.fail(ModelsHelper.getInstance().onReceiveErrorGeneric.bind(this,'Clone Plant (POST)'));\t\t\r\n\t\t},\r\n\r\n\t\t_onReceivingPlantCloned: function(oMsg, sStatus, oReturnData){\r\n\t\t\t\t\t// Cloning plant was successful; add clone to model and open in details view\r\n\t\t\t\t\tthis.applyToFragment('dialogClonePlant',(o)=>o.close());\r\n\t\t\t\t\tMessageUtil.getInstance().addMessageFromBackend(oMsg.message);\r\n\r\n\t\t\t\t\tvar oPlantSaved = oMsg.plants[0];\r\n\t\t\t\t\tvar aPlants = this.getOwnerComponent().getModel('plants').getProperty('/PlantsCollection');\r\n\t\t\t\t\taPlants.push(oPlantSaved);  // append at end to preserve change tracking with clone \r\n\t\t\t\t\tthis.getOwnerComponent().getModel('plants').updateBindings();\r\n\r\n\t\t\t\t\t// ...and add to cloned plants to allow change tracking\r\n\t\t\t\t\tvar oPlantClone = Util.getClonedObject(oPlantSaved);\r\n\t\t\t\t\tthis.getOwnerComponent().oPlantsDataClone.PlantsCollection.push(oPlantClone);\r\n\t\t\t\t\tMessageToast.show(oMsg.message.message);\r\n\r\n\t\t\t\t\t// finally navigate to the newly created plant in details view\r\n\t\t\t\t\tNavigation.navToPlantDetails.call(this, oPlantSaved.id);\r\n\t\t\t\t\tUtil.stopBusyDialog();\r\n\t\t},\r\n\t\t\r\n\t\tonPressButtonSubmitRenamePlant: function(evt){\r\n\t\t\t// use ajax to rename plant in backend\r\n\t\t\tvar sNewPlantName = this.byId('inputNewPlantName').getValue().trim();\r\n\t\t\t\r\n\t\t\t// check if duplicate\r\n\t\t\tif (sNewPlantName === ''){\r\n\t\t\t\tMessageToast.show('Empty not allowed.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//check if new\r\n\t\t\tif(this.isPlantNameInPlantsModel(sNewPlantName)){\r\n\t\t\t\tMessageToast.show('Plant Name already exists.');\r\n\t\t\t\treturn;\r\n\t\t\t}\t\t\t\r\n\r\n\t\t\t// ajax call\r\n\t\t\tUtil.startBusyDialog(\"Renaming...\", '\"'+this._oCurrentPlant.plant_name+'\" to \"'+sNewPlantName+'\"');\r\n\t\t\tvar dPayload = {'OldPlantName': this._oCurrentPlant.plant_name,\r\n\t\t\t\t\t\t\t'NewPlantName': sNewPlantName};\r\n\t    \t$.ajax({\r\n\t\t\t\t  url: Util.getServiceUrl('plants/'),\r\n\t\t\t\t  type: 'PUT',\r\n\t\t\t\t  contentType: \"application/json\",\r\n\t\t\t\t  data: JSON.stringify(dPayload),\r\n\t\t\t\t  context: this\r\n\t\t\t\t})\r\n\t\t\t\t.done(this._onReceivingPlantNameRenamed)\r\n\t\t\t\t.fail(ModelsHelper.getInstance().onReceiveErrorGeneric.bind(this,'Plant (PUT)'));\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\t_onReceivingPlantNameRenamed: function(oMsg, sStatus, oReturnData){\r\n\t\t\t//plant was renamed in backend\r\n\t\t\tUtil.stopBusyDialog();\r\n\t\t\tMessageToast.show(oMsg.message.message);\r\n\t\t\tMessageUtil.getInstance().addMessageFromBackend(oMsg.message);\r\n\t\t\t\r\n\t\t\tUtil.startBusyDialog('Loading...', 'Loading plants and images data');\r\n\t\t\t\r\n\t\t\tvar oModelsHelper = ModelsHelper.getInstance();\r\n\t\t\toModelsHelper.reloadPlantsFromBackend();\r\n\t\t\t// oModelsHelper.reloadImagesFromBackend();\r\n\t\t\toModelsHelper.resetImagesRegistry();\r\n\t\t\t//todo trigger reinit of this view (updateBindings/refresh of model doesn't update this view's images)\r\n\r\n\t\t\tthis.requestImagesForPlant(this._oCurrentPlant.id);\r\n\t\t\t\r\n\t\t\toModelsHelper.reloadTaxaFromBackend();\r\n\t\t\t\r\n\t\t\tthis.applyToFragment('dialogRenamePlant',(o)=>o.close());\r\n\t\t},\r\n\r\n\r\n\t\trequestImagesForPlant: function(plant_id){\r\n\t\t\t// request data from backend\r\n\t\t\tvar sId = encodeURIComponent(plant_id);\r\n\t\t\tvar uri = 'plants/'+sId+'/images/';\r\n\t\t\t\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: Util.getServiceUrl(uri),\r\n\t\t\t\t// data: ,\r\n\t\t\t\tcontext: this,\r\n\t\t\t\tasync: true\r\n\t\t\t})\r\n\t\t\t.done(this._onReceivingImagesForPlant.bind(this, plant_id))\r\n\t\t\t.fail(ModelsHelper.getInstance().onReceiveErrorGeneric.bind(this,'Plant Images (GET)'));\t\r\n\t\t},\r\n\r\n\t\t_onReceivingImagesForPlant: function(plant_id, oData, sStatus, oReturnData){\r\n\t\t\tthis.addPhotosToRegistry(oData);\r\n\t\t\tthis.getOwnerComponent().imagesPlantsLoaded.add(plant_id);\r\n\t\t\tthis.resetImagesCurrentPlant(plant_id);\r\n\t\t\tthis.getOwnerComponent().getModel('images').updateBindings();\r\n\r\n\t\t},\r\n\r\n\t\tonUploadPlantPhotosToServer: function(evt){\r\n\t\t\t//upload images and directly assign them to supplied plant; no keywords included\r\n\t\t\tvar oFileUploader = this.byId(\"idPlantPhotoUpload\");\r\n\t\t\tif (!oFileUploader.getValue()) {\r\n\t\t\t\t// \r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar sPath = 'plants/' + this._oCurrentPlant.id + '/images/'\r\n\t\t\tUtil.startBusyDialog('Uploading...', 'Image File(s)');\r\n\t\t\tvar sUrl = Util.getServiceUrl(sPath);\r\n\t\t\toFileUploader.setUploadUrl(sUrl);\r\n\t\t\t// oFileUploader.setAdditionalData(JSON.stringify(dictAdditionalData));\r\n\r\n\t\t\toFileUploader.upload();\r\n\t\t},\r\n\r\n\t\thandleUploadPlantImagesComplete: function(evt){\r\n\t\t\t// handle message, show error if required\r\n\t\t\tvar oResponse = JSON.parse(evt.getParameter('responseRaw'));\r\n\t\t\tif(!oResponse){\r\n\t\t\t\tsMsg = \"Upload complete, but can't determine status.\";\r\n\t\t\t\tMessageUtil.getInstance().addMessage('Warning', sMsg, undefined, undefined);\r\n\t\t\t}\r\n\t\t\tMessageUtil.getInstance().addMessageFromBackend(oResponse.message);\r\n\t\t\t\r\n\t\t\t// add to images registry and refresh current plant's images\r\n\t\t\tif(oResponse.images.length > 0){\r\n\t\t\t\tModelsHelper.getInstance().addToImagesRegistry(oResponse.images);\r\n\t\t\t\tthis.resetImagesCurrentPlant(this._oCurrentPlant.id);\r\n\t\t\t\tthis.getOwnerComponent().getModel('images').updateBindings();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tUtil.stopBusyDialog();\r\n\t\t\tMessageToast.show(oResponse.message.message);\r\n\t\t},\r\n\r\n\t\tonPressButtonCreateDescendantPlant: function(evt){\r\n\t\t\t// triggered by button in details upper menu\r\n\t\t\t// opens dialog to create descendant plant with current plant as mother plant\r\n\t\t\t\r\n\t\t\t// check if there are any unsaved changes\r\n\t\t\tvar aModifiedPlants = this.getModifiedPlants();\r\n\t\t\tvar aModifiedImages = this.getModifiedImages();\r\n\t\t\tvar aModifiedTaxa = this.getModifiedTaxa();\r\n\t\t\tif((aModifiedPlants.length !== 0)||(aModifiedImages.length !== 0)||(aModifiedTaxa.length !== 0)){\r\n\t\t\t\tMessageToast.show('There are unsaved changes. Save modified data or reload data first.');\r\n\t\t\t\treturn;\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.applyToFragment('dialogCreateDescendant',(o)=>{\r\n\t\t\t\t// create json model descendant and set it (default settings are when opening)\r\n\t\t\t\tvar defaultPropagationType = 'seed (collected)';\r\n\t\t\t\tvar descendantPlantDataInit = {\r\n\t\t\t\t\t\"propagationType\": defaultPropagationType,\r\n\t\t\t\t\t\"parentPlant\": this.getPlantById(this._currentPlantId).plant_name,\r\n\t\t\t\t\t\"parentPlantPollen\": undefined,\r\n\t\t\t\t\t\"descendantPlantName\": undefined\r\n\t\t\t\t};\r\n\t\t\t\tvar modelDescendant = new JSONModel(descendantPlantDataInit);\r\n\t\t\t\to.setModel(modelDescendant, \"descendant\");\r\n\t\t\t\tthis.updatePlantNameSuggestion();\r\n\t\t\t\to.open();\r\n\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tonDescendantDialogCreate: function(evt){\r\n\t\t\t// triggered from create-descendant-dialog to create the descendant plant\r\n\t\t\t//todo validate if existing\r\n\t\t\tvar descendantPlantData = this.byId('dialogCreateDescendant').getModel('descendant').getData();\r\n\r\n\t\t\tif (!descendantPlantData.propagationType || !descendantPlantData.propagationType.length){\r\n\t\t\t\tMessageToast.show('Choose propagation type.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// validate parent plant (obligatory and valid) and parent plant pollen (valid if supplied)\r\n\t\t\tif (!descendantPlantData.parentPlant || !this.isPlantNameInPlantsModel(descendantPlantData.parentPlant)){\r\n\t\t\t\tMessageToast.show('Check parent plant.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar propagationType = this.getSuggestionItem('propagationTypeCollection', descendantPlantData.propagationType);\r\n\t\t\tif (propagationType.hasParentPlantPollen === true &&\r\n\t\t\t\t!!descendantPlantData.parentPlantPollen && \r\n\t\t\t\t!this.isPlantNameInPlantsModel(descendantPlantData.parentPlantPollen)){\r\n\t\t\t\t\tMessageToast.show('Check parent plant pollen.');\r\n\t\t\t\t\treturn;\r\n\t\t\t};\r\n\r\n\t\t\t// validate new plant name\r\n\t\t\tif (!descendantPlantData.descendantPlantName || !descendantPlantData.descendantPlantName.trim().length){\r\n\t\t\t\tMessageToast.show('Enter new plant name.');\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\r\n\t\t\tif (this.isPlantNameInPlantsModel(descendantPlantData.descendantPlantName)){\r\n\t\t\t\tMessageToast.show('Plant with that name already exists.');\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\r\n\t\t\t// assemble new plant and save it\r\n\t\t\tvar parentPlant = this.getPlantByName(descendantPlantData.parentPlant);\r\n\t\t\tvar newPlant = {\r\n\t\t\t\t'id': undefined,  // created in backend\r\n\t\t\t\t'plant_name': descendantPlantData.descendantPlantName,\r\n\t\t\t\t'propagation_type': descendantPlantData.propagationType,\r\n\t\t\t\t'taxon_id': propagationType.hasParentPlantPollen ? undefined : parentPlant.taxon_id,\r\n\t\t\t\t'field_number': propagationType.hasParentPlantPollen ? '-' : parentPlant.field_number,\r\n\t\t\t\t'geographic_origin': propagationType.hasParentPlantPollen ? '-' : parentPlant.geographic_origin,\r\n\t\t\t\t'nursery_source': '-',\r\n\t\t\t\t'last_update': undefined,  //auto-derived in backend\r\n\t\t\t\t'descendant_plants_all': [],  //auto-derived in backend\r\n\t\t\t\t'sibling_plants': [],  //auto-derived in backend\r\n\t\t\t\t'same_taxon_plants': [],  //auto-derived in backend\r\n\t\t\t\t'tags': [],\r\n\r\n\t\t\t\t// 'parent_plant': parentPlant.plant_name,\r\n\t\t\t\t// 'parent_plant_id': parentPlant.id,\r\n\t\t\t\t'parent_plant': {id: parentPlant.id, \r\n\t\t\t\t\t\t\t\t plant_name: parentPlant.plant_name, \r\n\t\t\t\t\t\t\t\t active: parentPlant.active},\r\n\t\t\t\t'active': true };\r\n\t\t\tif (!!descendantPlantData.parentPlantPollen && descendantPlantData.parentPlantPollen.length){\r\n\t\t\t\t// newPlant.parent_plant_pollen = descendantPlantData.parentPlantPollen;\r\n\t\t\t\t// newPlant.parent_plant_pollen_id = this.getPlantId(descendantPlantData.parentPlantPollen);\r\n\t\t\t\tvar oParentPlantPollen = this.getPlantByName(descendantPlantData.parentPlantPollen);\r\n\t\t\t\tnewPlant.parent_plant_pollen = {id: oParentPlantPollen.id, \r\n\t\t\t\t\t\t\t\t\t\t\t\tplant_name: descendantPlantData.parentPlantPollen,\r\n\t\t\t\t\t\t\t\t\t\t\t\tactive: oParentPlantPollen.active}\r\n\t\t\t}\r\n\t\t\tthis.saveNewPlant(newPlant);\r\n\r\n\t\t\tthis.applyToFragment('dialogCreateDescendant',(o)=>o.close());\r\n\t\t},\r\n\r\n\t\t_generatePlantNameWithRomanizedSuffix: function(baseName, beginWith){\r\n\t\t\t// e.g. Aeonium spec. II -> Aeonium spec. III if the former already exists\r\n\t\t\tfor (var i = beginWith; i < 100; i++) {\r\n\t\t\t\tvar latinNumber = Util.romanize(i);\r\n\t\t\t\tvar suggestedName = baseName + ' ' + latinNumber;\r\n\t\t\t\tif (!this.isPlantNameInPlantsModel(suggestedName)){\r\n\t\t\t\t\treturn suggestedName;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_generateNewPlantNameSuggestion: function(parentPlantName, parentPlantPollenName=undefined, hasParentPlantPollen){\r\n\t\t\t// generate new plant name suggestion\r\n\t\t\t// ... only if parent plant names are set\r\n\t\t\tif (!parentPlantName || !parentPlantName.trim().length){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar parentPlant = this.getPlantByName(parentPlantName);\r\n\t\t\t\r\n\t\t\tvar includeParentPlantPollen = (hasParentPlantPollen === true &&\r\n\t\t\t\tparentPlantPollenName && parentPlantPollenName.trim().length);\r\n\t\t\t\r\n\t\t\tif(hasParentPlantPollen === true && !includeParentPlantPollen){\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\r\n\t\t\t// hybrid of two parents\r\n\t\t\tif (includeParentPlantPollen){\r\n\t\t\t\tvar parentPlantPollen = this.getPlantByName(parentPlantPollenName);\r\n\t\t\t\tvar suggestedName = ( parentPlant.botanical_name || parentPlantName ) + ' × ' + \r\n\t\t\t\t\t( parentPlantPollen.botanical_name || parentPlantPollenName );\r\n\t\t\t\tif(this.isPlantNameInPlantsModel(suggestedName)){\r\n\t\t\t\t\t// we need to find a variant using latin numbers, starting with II\r\n\t\t\t\t\t// Consider existing latin number at ending\r\n\t\t\t\t\tsuggestedName = this._generatePlantNameWithRomanizedSuffix(suggestedName, 2);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Just one parent: add latin number to parent plant name\r\n\t\t\t\t// Consider existing latin number at ending\r\n\t\t\t} else {\r\n\t\t\t\tvar baseName = parentPlantName;\r\n\t\t\t\tvar reRomanNumber = /\\sM{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/;\r\n\t\t\t\tvar romanNumberMatch = baseName.match(reRomanNumber);\r\n\t\t\t\tif (!!romanNumberMatch){\r\n\t\t\t\t\tvar romanNumber = romanNumberMatch.pop();\r\n\t\t\t\t\tvar beginWith = Util.arabize(romanNumber) + 1;\r\n\t\t\t\t\t// remove the roman number at the end\r\n\t\t\t\t\tbaseName = baseName.substr(0, parentPlantName.lastIndexOf(' ')); \r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar beginWith = 2;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// find suitable roman number suffix\r\n\t\t\t\tvar suggestedName = this._generatePlantNameWithRomanizedSuffix(baseName, beginWith);\r\n\t\t\t}\r\n\r\n\t\t\treturn suggestedName;\r\n\t\t},\r\n\r\n\t\tupdatePlantNameSuggestion: function(){\r\n\t\t\t// generate new plant name suggestion\r\n\t\t\tif (!this.byId('autoNameDescendantPlantName').getSelected()){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar descendantPlantData = this.byId('dialogCreateDescendant').getModel('descendant').getData();\r\n\t\t\tif(descendantPlantData.propagationType && descendantPlantData.propagationType.length){\r\n\t\t\t\tvar propagationType = this.getSuggestionItem('propagationTypeCollection', descendantPlantData.propagationType);\r\n\t\t\t}\r\n\t\t\tvar suggestedName = this._generateNewPlantNameSuggestion(descendantPlantData.parentPlant, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescendantPlantData.parentPlantPollen, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpropagationType.hasParentPlantPollen);\r\n\t\t\tthis.byId('dialogCreateDescendant').getModel('descendant').setProperty('/descendantPlantName', suggestedName);\r\n\t\t},\r\n\r\n\t\tonDescendantDialogChangeParent: function(event, parentType){\r\n\t\t\t// reset parent plant (/pollen) input if entered plant name is invalid\r\n\t\t\tvar parentPlantName = event.getParameter('newValue').trim();\r\n\r\n\t\t\tif (!parentPlantName || !this.isPlantNameInPlantsModel(parentPlantName)){\r\n\t\t\t\tevent.getSource().setValue(undefined);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.updatePlantNameSuggestion();\r\n\t\t},\r\n\r\n\t\tonDescendantDialogSwitchParents: function(){\r\n\t\t\t// triggered by switch button; switch parent plant and parent plant pollen\r\n\t\t\tvar model = this.byId('dialogCreateDescendant').getModel('descendant');\r\n\t\t\tvar parentPlantName = model.getProperty('/parentPlant');\r\n\t\t\tmodel.setProperty('/parentPlant', model.getProperty('/parentPlantPollen'));\r\n\t\t\tmodel.setProperty('/parentPlantPollen', parentPlantName);\r\n\r\n\t\t\tthis.updatePlantNameSuggestion();\r\n\t\t},\r\n\r\n\t\tonSwitchImageEditDescription: function(oEvent){\r\n\t\t\tif (this.getView().getModel('status').getProperty('/images_editable')){\r\n\t\t\t\tthis.getView().getModel('status').setProperty('/images_editable', false);\r\n\t\t\t} else {\r\n\t\t\t\tthis.getView().getModel('status').setProperty('/images_editable', true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t});\r\n}, true);"],"mappings":"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"}