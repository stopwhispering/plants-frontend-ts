sap.ui.define(["sap/ui/model/json/JSONModel","plants/ui/customClasses/MessageUtil","plants/ui/customClasses/Util","sap/m/MessageToast","sap/ui/base/ManagedObject","plants/ui/model/formatter","sap/ui/core/library"],function(e,t,o,n,s,a,r){function i(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const c=i(t);const d=i(a);const l=r["MessageType"];const p=s.extend("plants.ui.model.ModelsHelper",{constructor:function e(t){s.prototype.constructor.call(this);this.formatter=new d;this._component=t;this._component.getModel("plants").attachRequestCompleted(this._onReceivingPlantsFromBackend.bind(this));this._component.getModel("plants").attachRequestFailed(this.onReceiveErrorGeneric.bind(this,"Plants Model"));this._component.getModel("taxon").attachRequestCompleted(this._onReceivingTaxaFromBackend.bind(this));this._component.getModel("taxon").attachRequestFailed(this.onReceiveErrorGeneric.bind(this,"Taxon Model"))},onReceiveErrorGeneric:function e(t,s,a,r){o.stopBusyDialog();if(!!s&&!!s.responseJSON&&!!s.responseJSON.detail&&!!s.responseJSON.detail.type){c.getInstance().addMessageFromBackend(s.responseJSON.detail);n.show(s.responseJSON.detail.type+": "+s.responseJSON.detail.message);return}const i=s;if(!!i.getParameter&&i.getParameter("message")){const e="Error at "+t+" - Could not reach Server (Error: "+s.status+" "+s.statusText+")";c.getInstance().addMessage(l.Error,e);n.show(e);return}if(!!s&&!s.responseJSON){const e="Error at "+t+" - Unexpected Backend Error (Error: "+s.status+" "+s.statusText+")";c.getInstance().addMessage(l.Error,e);n.show(e);return}n.show("Unknown Error. See onReceiveErrorGeneric and handle.")},_onReceivingPlantsFromBackend:function e(t){const n=t.getSource();this._component.oPlantsDataClone=o.getClonedObject(n.getData());var s=o.parse_resource_from_url(t.getParameter("url"));c.getInstance().addMessage(l.Information,"Loaded Plants from backend",undefined,"Resource: "+s)},_onReceivingTaxaFromBackend:function e(t){const n=t.getSource();this._component.oTaxonDataClone=o.getClonedObject(n.getData());var s=o.parse_resource_from_url(t.getParameter("url"));c.getInstance().addMessage(l.Information,"Loaded Taxa from backend",undefined,"Resource: "+s)},reloadPlantsFromBackend:function e(){var t=o.getServiceUrl("plants/");this._component.getModel("plants").loadData(t);o.stopBusyDialog()},resetImagesRegistry:function e(){this._component.imagesRegistry={};this._component.imagesRegistryClone={};this._component.imagesPlantsLoaded=new Set;this._component.getModel("images").updateBindings(false);this._component.getModel("untaggedImages").updateBindings(false)},addToImagesRegistry:function e(t){t.forEach(e=>{var t=e["filename"];if(!(t in this._component.imagesRegistry)){this._component.imagesRegistry[t]=e}this._component.imagesRegistryClone[t]=o.getClonedObject(e)})},reloadTaxaFromBackend:function e(){var t=o.getServiceUrl("taxa/");this._component.getModel("taxon").loadData(t)},reloadKeywordProposalsFromBackend:function t(){var n=o.getServiceUrl("proposals/KeywordProposals");if(!this._component.getModel("keywords")){this._component.setModel(new e(n),"keywords")}else{this._component.getModel("keywords").loadData(n)}},reloadTraitCategoryProposalsFromBackend:function t(){var n=o.getServiceUrl("proposals/TraitCategoryProposals");if(!this._component.getModel("trait_categories")){this._component.setModel(new e(n),"trait_categories")}else{this._component.getModel("trait_categories").loadData(n)}},reloadNurserySourceProposalsFromBackend:function t(){var n=o.getServiceUrl("proposals/NurserySourceProposals");if(!this._component.getModel("nurseries_sources")){var s=new e(n);s.setSizeLimit(50);this._component.setModel(s,"nurseries_sources")}else{this._component.getModel("nurseries_sources").loadData(n)}},reloadPropertyNamesFromBackend:function t(){var n=o.getServiceUrl("property_names/");if(!this._component.getModel("propertyNames")){var s=new e(n);s.setSizeLimit(300);this._component.setModel(s,"propertyNames")}else{this._component.getModel("propertyNames").loadData(n)}}});p.getInstance=function e(t){if(!p._instance&&!!t){p._instance=new p(t)}return p._instance};return p});