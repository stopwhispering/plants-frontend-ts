{"version":3,"file":"ImageUtil.js","names":["Navigation","ImageUtil","ManagedObject","navigation","getInstance","onInputImageNewPlantNameSubmit","evt","sModel","getSource","data","getId","sPlantName","getParameter","getBindingContext","getObject","plant_name","trim","isPlantNameInPlantsModel","MessageToast","show","oBindingContextImage","getParent","sPlantId","getPlantId","_addPlantNameToImage","setValue","onIconPressTagDetailsPlant","oPlant","getPlantById","_currentPlantId","id","resetImagesCurrentPlant","aCurrentPlantNames","plants","dictPlant","key","text","plant_id","Util","isDictKeyInArray","push","console","log","getPath","getModel","updateBindings","onPressImagePlantToken","modelName","iIndexPlant","navToPlantDetails","call","handleErrorMessageBox","onIconPressAssignImageToEvent","oSource","sPathCurrentImage","applyToFragment","o","bindElement","path","model","openBy","onAssignEventToImage","sPathSelectedEvent","getBindingContextPath","oImage","oImageAssignment","filename","oEvent","getView","getProperty","images","length","found","find","image","_getFragment","close","onIconPressUnassignImageFromEvent","sPath","sEventImages","substring","lastIndexOf","aEventImages","getOwnerComponent","iPosition","indexOf","splice","refresh","_instance"],"sources":["../../src/customClasses/ImageUtil.ts"],"sourcesContent":["import MessageToast from \"sap/m/MessageToast\"\r\nimport * as Util from \"plants/ui/customClasses/Util\";\r\nimport Navigation from \"plants/ui/customClasses/Navigation\"\r\nimport ManagedObject from \"sap/ui/base/ManagedObject\";\r\n\r\n\r\n/**\r\n * @namespace plants.ui.customClasses\r\n */\r\nexport default class ImageUtil extends ManagedObject{\r\n\t\tprivate static _instance: ImageUtil;\r\n\t\tprivate navigation = Navigation.getInstance();\r\n\t\t       \r\n        // generate or return singleton\r\n        public static getInstance(): ImageUtil {\r\n            if (!ImageUtil._instance) {\r\n                ImageUtil._instance = new ImageUtil();\r\n            }\r\n            return ImageUtil._instance;\r\n        }\r\n\r\n\t\tonInputImageNewPlantNameSubmit(evt: Event){\r\n\t\t\t// on enter add new plant to image in model\r\n\t\t\t// called by either submitting input or selecting from suggestion table (both with different model)\r\n\t\t\tvar sModel = evt.getSource().data('sModel');\r\n\r\n\t\t\tif(evt.getId() === 'suggestionItemSelected'){\r\n\t\t\t\t// var sPlantName = evt.getParameter('selectedRow').getCells()[0].getText();\r\n\t\t\t\tvar sPlantName = evt.getParameter('selectedRow').getBindingContext('plants').getObject().plant_name;\r\n\t\t\t} else {\r\n\t\t\t\tsPlantName = evt.getParameter('value').trim();  //submit disabled\r\n\t\t\t}\r\n\r\n\t\t\t//check if plant exists and is not empty\r\n\t\t\tif(!this.isPlantNameInPlantsModel(sPlantName) || !(sPlantName)){\r\n\t\t\t\tMessageToast.show('Plant Name does not exist.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//add to model\r\n\t\t\tvar oBindingContextImage = evt.getSource().getParent().getBindingContext(sModel);\r\n\t\t\tvar sPlantId = this.getPlantId(sPlantName);\r\n\t\t\tthis.ImageUtil._addPlantNameToImage(sPlantName, sPlantId, oBindingContextImage);\r\n\t\t\t\r\n\t\t\tevt.getSource().setValue('');\r\n\t\t}\r\n\r\n\t\tpublic onIconPressTagDetailsPlant(evt: Event){\r\n\t\t\t//adds current plant in details view to the image in untagged view\r\n\t\t\tvar oPlant = this.getPlantById(this._currentPlantId);\r\n\t\t\tvar oBindingContextImage = evt.getSource().getParent().getBindingContext(\"untaggedImages\");\r\n\t\t\tthis.ImageUtil._addPlantNameToImage(oPlant.plant_name, oPlant.id, oBindingContextImage);\r\n\t\t\t// have details view images updated\r\n\t\t\tthis.resetImagesCurrentPlant(this._currentPlantId);\r\n\t\t}\r\n\r\n\t\t_addPlantNameToImage(sPlantName, sPlantId, oBindingContextImage){\r\n\t\t\t//add a plant (by name) to image in images model\r\n\t\t\tvar aCurrentPlantNames = oBindingContextImage.getObject().plants;\r\n\t\t\tvar dictPlant = {\r\n\t\t\t\tkey: sPlantName, \r\n\t\t\t\ttext: sPlantName,\r\n\t\t\t\tplant_id: sPlantId\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t// check if already in list\r\n\t\t\tif (Util.isDictKeyInArray(dictPlant, aCurrentPlantNames)){\r\n\t\t\t\tMessageToast.show('Plant Name already assigned. ');\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\taCurrentPlantNames.push(dictPlant);\r\n\t\t\t\tconsole.log('Assigned plant to image: '+ sPlantName + ' (' + oBindingContextImage.getPath() + ')');\r\n\t\t\t\toBindingContextImage.getModel().updateBindings();\r\n\t\t\t\treturn true;\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tonPressImagePlantToken(modelName, evt){\r\n\t\t\t//model is either images or untaggedImages\r\n\t\t\tvar iIndexPlant = evt.getSource().getBindingContext(modelName).getObject().plant_id;\r\n\t\t\t\r\n\t\t\tif (iIndexPlant >= 0){\r\n\t\t\t \t//navigate to plant in layout's current column (i.e. middle column)\r\n\t\t\t \tthis.navigation.navToPlantDetails.call(this, iIndexPlant);\r\n\t\t\t } else {\r\n\t\t\t \tthis.handleErrorMessageBox(\"Can't find selected Plant\");\r\n\t\t\t }\r\n\t\t}\r\n\t\t\r\n\t\tonIconPressAssignImageToEvent(evt: Event){\r\n\t\t\t// triggered by icon beside image; assign that image to one of the plant's events\r\n\t\t\t// generate dialog from fragment if not already instantiated\r\n\t\t\tvar oSource = evt.getSource();\r\n\t\t\tvar sPathCurrentImage = evt.getSource().getBindingContext(\"images\").getPath();\r\n\t\t\tthis.applyToFragment('dialogAssignEventToImage',(o)=>{\r\n\t\t\t\t// bind the selected image's path in images model to the popover dialog\r\n\t\t\t\to.bindElement({ path: sPathCurrentImage,\r\n\t\t\t\t\t   \t\t  \tmodel: \"images\" });\t\r\n\t\t\t\to.openBy(oSource);\t\r\n\t\t\t});\t\r\n\t\t}\r\n\t\t\r\n\t\tonAssignEventToImage(evt: Event){\r\n            // triggered upon selection of event in event selection dialog for an image\r\n\t\t\t// get selected event\r\n\t\t\tvar sPathSelectedEvent = evt.getSource().getBindingContextPath('events');\r\n\t\t\t\r\n\t\t\t// get image\r\n\t\t\tvar oImage = evt.getSource().getBindingContext('images').getObject();\r\n\t\t\tvar oImageAssignment = {\r\n\t\t\t\t\t\t\t\t\tfilename:      oImage.filename\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\r\n\t\t\t// check if already assigned\r\n\t\t\tvar oEvent = this.getView().getModel('events').getProperty(sPathSelectedEvent);\r\n\t\t\tif(!!oEvent.images && oEvent.images.length > 0){\r\n\t\t\t\tvar found = oEvent.images.find(function(image) {\r\n\t\t\t\t  return image.filename === oImageAssignment.filename;\r\n\t\t\t\t});\r\n\t\t\t\tif(found){\r\n\t\t\t\t\tMessageToast.show('Event already assigned to image.');\r\n\t\t\t\t\tthis._getFragment('dialogAssignEventToImage').close();\r\n\t\t\t\t\treturn;\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// assign\r\n\t\t\tif(!oEvent.images){\r\n\t\t\t\toEvent.images = [oImageAssignment];\r\n\t\t\t} else {\r\n\t\t\t\toEvent.images.push(oImageAssignment);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tMessageToast.show('Assigned.');\r\n\t\t\tthis.getView().getModel('events').updateBindings();\r\n\t\t\tthis._getFragment('dialogAssignEventToImage').close();\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tonIconPressUnassignImageFromEvent(evt: Event){\r\n            // triggered by unassign control next to an image in the events list\r\n\t\t\tvar sPath = evt.getParameter('listItem').getBindingContextPath('events');\r\n\t\t\tvar oImage = evt.getSource().getModel('events').getProperty(sPath);\r\n\t\t\t\r\n\t\t\tvar sEventImages = sPath.substring(0,sPath.lastIndexOf('/'));\r\n\t\t\tvar aEventImages = this.getOwnerComponent().getModel('events').getProperty(sEventImages);\r\n\t\t\t\r\n\t\t\tvar iPosition = aEventImages.indexOf(oImage);\r\n\t\t\tif(iPosition===-1){\r\n\t\t\t\tMessageToast.show(\"Can't find image.\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\taEventImages.splice(iPosition, 1);\r\n\t\t\tthis.getOwnerComponent().getModel('events').refresh();  //same like updateBindings()\t\t\t\r\n\t\t}\r\n}"],"mappings":"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"}