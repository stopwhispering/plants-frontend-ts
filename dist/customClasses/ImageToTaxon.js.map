{"version":3,"file":"ImageToTaxon.js","names":["ImageToTaxon","ManagedObject","assignImageToTaxon","oSource","oTaxonModel","oImage","getBindingContext","getObject","oImageAssignment","filename","description","oTaxon","images","length","found","find","image","MessageToast","show","push","name","updateBindings","unassignImageFromTaxon","sPathImageAssignmentToTaxon","getPath","sPathImages","substr","lastIndexOf","aImageAssignments","getProperty","iPosition","indexOf","splice","refresh"],"sources":["../../src/customClasses/ImageToTaxon.ts"],"sourcesContent":["import MessageToast from \"sap/m/MessageToast\"\r\nimport ManagedObject from \"sap/ui/base/ManagedObject\";\r\nimport Icon from \"sap/ui/core/Icon\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport { PImage } from \"../definitions/ImageFromBackend\";\r\nimport { PTaxon, PTaxonImage } from \"../definitions/TaxonFromBackend\";\r\n\r\n/**\r\n * @namespace plants.ui.customClasses\r\n */\r\nexport default class ImageToTaxon extends ManagedObject {\r\n\r\n\tpublic assignImageToTaxon(oSource: Icon, oTaxonModel: JSONModel) {\r\n\t\t// triggered by clicking icon next to image in images list; moves the image to the taxon box\r\n\r\n\t\t// get image\r\n\t\tconst oImage = <PImage>oSource.getBindingContext('images')!.getObject();\r\n\t\tvar oImageAssignment = <PTaxonImage>{\r\n\t\t\tfilename: oImage.filename,\r\n\t\t\tdescription: oImage.description  // default description is image description, but may be altered later\r\n\t\t};\r\n\r\n\t\t// get current plant's taxon\r\n\t\tconst oTaxon = <PTaxon>oSource.getBindingContext('taxon')!.getObject();\r\n\r\n\t\t// check if already assigned\r\n\t\tif (!!oTaxon.images && oTaxon.images.length > 0) {\r\n\t\t\tvar found = oTaxon.images.find(function (image) {\r\n\t\t\t\treturn image.filename === oImageAssignment.filename;\r\n\t\t\t});\r\n\t\t\tif (found) {\r\n\t\t\t\tMessageToast.show('Taxon already assigned to image.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// assign\r\n\t\tif (!oTaxon.images) {\r\n\t\t\toTaxon.images = [oImageAssignment];\r\n\t\t} else {\r\n\t\t\toTaxon.images.push(oImageAssignment);\r\n\t\t}\r\n\r\n\t\tMessageToast.show('Assigned to taxon ' + oTaxon.name);\r\n\t\toTaxonModel.updateBindings(false);\r\n\t}\r\n\r\n\tpublic unassignImageFromTaxon(oSource: Icon, oTaxonModel: JSONModel) {\r\n\t\t// triggered by clicking delete icon next to image in taxon box\r\n\t\t// unassigns the image from the taxon (without deleting any image)\r\n\t\tconst oImageAssignment = <PTaxonImage>oSource.getBindingContext('taxon')!.getObject();\r\n\t\tconst sPathImageAssignmentToTaxon = oSource.getBindingContext('taxon')!.getPath();\r\n\r\n\t\t// var sPathImageAssignment = evt.getSource().getBindingContext('taxon').getPath();\r\n\t\tvar sPathImages = sPathImageAssignmentToTaxon.substr(0, sPathImageAssignmentToTaxon.lastIndexOf('/'));\r\n\r\n\t\tvar aImageAssignments = <PTaxonImage[]>oTaxonModel.getProperty(sPathImages);\r\n\t\tvar iPosition = aImageAssignments.indexOf(oImageAssignment);\r\n\t\tif (iPosition === -1) {\r\n\t\t\tMessageToast.show(\"Can't find image.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\taImageAssignments.splice(iPosition, 1);\r\n\t\toTaxonModel.refresh();  //same like updateBindings(false)\r\n\t}\r\n\r\n}"],"mappings":";EAOA;AACA;AACA;EAFA,MAGqBA,YAAY,GAASC,aAAa;IAE/CC,kBAAkB,+BAACC,OAAa,EAAEC,WAAsB,EAAE;MAChE;;MAEA;MACA,MAAMC,MAAM,GAAWF,OAAO,CAACG,iBAAiB,CAAC,QAAQ,CAAC,CAAEC,SAAS,EAAE;MACvE,IAAIC,gBAAgB,GAAgB;QACnCC,QAAQ,EAAEJ,MAAM,CAACI,QAAQ;QACzBC,WAAW,EAAEL,MAAM,CAACK,WAAW,CAAE;MAClC,CAAC;;MAED;MACA,MAAMC,MAAM,GAAWR,OAAO,CAACG,iBAAiB,CAAC,OAAO,CAAC,CAAEC,SAAS,EAAE;;MAEtE;MACA,IAAI,CAAC,CAACI,MAAM,CAACC,MAAM,IAAID,MAAM,CAACC,MAAM,CAACC,MAAM,GAAG,CAAC,EAAE;QAChD,IAAIC,KAAK,GAAGH,MAAM,CAACC,MAAM,CAACG,IAAI,CAAC,UAAUC,KAAK,EAAE;UAC/C,OAAOA,KAAK,CAACP,QAAQ,KAAKD,gBAAgB,CAACC,QAAQ;QACpD,CAAC,CAAC;QACF,IAAIK,KAAK,EAAE;UACVG,YAAY,CAACC,IAAI,CAAC,kCAAkC,CAAC;UACrD;QACD;MACD;;MAEA;MACA,IAAI,CAACP,MAAM,CAACC,MAAM,EAAE;QACnBD,MAAM,CAACC,MAAM,GAAG,CAACJ,gBAAgB,CAAC;MACnC,CAAC,MAAM;QACNG,MAAM,CAACC,MAAM,CAACO,IAAI,CAACX,gBAAgB,CAAC;MACrC;MAEAS,YAAY,CAACC,IAAI,CAAC,oBAAoB,GAAGP,MAAM,CAACS,IAAI,CAAC;MACrDhB,WAAW,CAACiB,cAAc,CAAC,KAAK,CAAC;IAClC,CAAC;IAEMC,sBAAsB,mCAACnB,OAAa,EAAEC,WAAsB,EAAE;MACpE;MACA;MACA,MAAMI,gBAAgB,GAAgBL,OAAO,CAACG,iBAAiB,CAAC,OAAO,CAAC,CAAEC,SAAS,EAAE;MACrF,MAAMgB,2BAA2B,GAAGpB,OAAO,CAACG,iBAAiB,CAAC,OAAO,CAAC,CAAEkB,OAAO,EAAE;;MAEjF;MACA,IAAIC,WAAW,GAAGF,2BAA2B,CAACG,MAAM,CAAC,CAAC,EAAEH,2BAA2B,CAACI,WAAW,CAAC,GAAG,CAAC,CAAC;MAErG,IAAIC,iBAAiB,GAAkBxB,WAAW,CAACyB,WAAW,CAACJ,WAAW,CAAC;MAC3E,IAAIK,SAAS,GAAGF,iBAAiB,CAACG,OAAO,CAACvB,gBAAgB,CAAC;MAC3D,IAAIsB,SAAS,KAAK,CAAC,CAAC,EAAE;QACrBb,YAAY,CAACC,IAAI,CAAC,mBAAmB,CAAC;QACtC;MACD;MAEAU,iBAAiB,CAACI,MAAM,CAACF,SAAS,EAAE,CAAC,CAAC;MACtC1B,WAAW,CAAC6B,OAAO,EAAE,CAAC,CAAE;IACzB;EAAC;EAAA,OAvDmBjC,YAAY;AAAA"}