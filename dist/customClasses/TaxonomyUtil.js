sap.ui.define(["sap/m/MessageToast","plants/ui/customClasses/Util","plants/ui/customClasses/MessageUtil","plants/ui/model/ModelsHelper","sap/ui/base/ManagedObject"],function(e,t,n,i,a){function s(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const o=s(n);const d=s(i);const c=a.extend("plants.ui.customClasses.TaxonomyUtil",{findSpecies:function n(i,a,s,o){if(i.length===0){e.show("Enter species first.");return}t.startBusyDialog("Retrieving results from species search...");var c={species:i,includeKew:a,searchForGenus:s};$.ajax({url:t.getServiceUrl("search_external_biodiversity"),type:"POST",contentType:"application/json",data:JSON.stringify(c),context:this}).done(this._onReceivingSpeciesDatabase.bind(this,o)).fail(d.getInstance().onReceiveErrorGeneric.bind(this,"search_external_biodiversity (POST)"))},_onReceivingSpeciesDatabase:function e(n,i,a,s){t.stopBusyDialog();n.setData(i);o.getInstance().addMessageFromBackend(i.message)},chooseSpecies:function n(i,a,s,o,c,r){if(!i){e.show("Select item from results list first.");return}const l=i.getBindingContext("kewSearchResults").getObject();const g=l.fqId;if(a.startsWith("Error")){var u=""}else if(a===l.name.trim()){u=""}else{u=a}var f={fqId:g,hasCustomName:u.length===0?false:true,nameInclAddition:u,source:l.source,id:l.id?l.id:undefined,plant_id:o.id};t.startBusyDialog("Retrieving additional species information and saving them to Plants database...");const p=t.getServiceUrl("download_taxon_details");$.ajax({url:p,context:this,contentType:"application/json",type:"POST",data:JSON.stringify(f)}).done(this._onReceivingAdditionalSpeciesInformationSaved.bind(this,s,o,c,r)).fail(d.getInstance().onReceiveErrorGeneric.bind(this,"download_taxon_details (POST)"))},_onReceivingAdditionalSpeciesInformationSaved:function n(i,a,s,d,c,r,l){t.stopBusyDialog();e.show(c.message.message);o.getInstance().addMessageFromBackend(c.message);i.close();const g=d.getModel("plants");const u=d.getModel("taxon");a.botanical_name=c.botanical_name;a.taxon_id=c.taxon_data.id;g.updateBindings(false);var f="/TaxaDict/"+c.taxon_data.id;if(u.getProperty(f)===undefined){u.setProperty(f,c.taxon_data)}var p=s.getOwnerComponent().oTaxonDataClone;if(p.TaxaDict[c.taxon_data.id]===undefined){p.TaxaDict[c.taxon_data.id]=t.getClonedObject(c.taxon_data)}d.bindElement({path:"/TaxaDict/"+c.taxon_data.id,model:"taxon"})},findSpeciesTableSelectedOrDataUpdated:function e(t,n,i){if(i===undefined||i===null){t.setText("");n.setEditable(false);n.setValue("");return}var a=i.getBindingContext("kewSearchResults").getObject();var s;if(a.is_custom){n.setValue("");n.setEditable(false);s=""}else if(a.species===null||a.species===undefined){n.setValue("spec.");s="spec.";n.setEditable(true)}else{if(s==="spec."){n.setValue("");s=""}else{s=n.getValue()}n.setEditable(true)}t.setText(a.name+" "+s)},findSpeciesAdditionalNameLiveChange:function e(t){const n=t.byId("tableFindSpeciesResults").getSelectedItem();const i=n.getBindingContext("kewSearchResults").getObject();const a=t.byId("textFindSpeciesAdditionalName");const s=t.byId("inputFindSpeciesAdditionalName").getValue();if(!n){a.setText("Error: Select item from table first.");return}a.setText(i.name+" "+s)},findSpeciesBeforeOpen:function e(t){if(t.getBindingContext("taxon")===undefined||t.getBindingContext("taxon").getObject()===undefined){var n=""}else{n=t.getBindingContext("taxon").getObject().name}t.byId("inputFindSpecies").setValue(n);t.byId("inputFindSpeciesAdditionalName").setValue("")},refetchGbifImages:function e(n,i,a){t.startBusyDialog("Refetching Taxon Images from GBIF for GBIF ID ..."+n);var s={gbif_id:n};$.ajax({url:t.getServiceUrl("fetch_taxon_images"),type:"POST",contentType:"application/json",data:JSON.stringify(s),context:this}).done(this._onReceivingRefetchdeGbifImages.bind(this,i,a)).fail(d.getInstance().onReceiveErrorGeneric.bind(this,"search_external_bifetch_taxon_imagesodiversity (POST)"))},_onReceivingRefetchdeGbifImages:function e(n,i,a,s,d){t.stopBusyDialog();var c=n.getProperty("/TaxaDict/"+i.taxon_id);c.occurrenceImages=a.occurrenceImages;n.updateBindings(false);o.getInstance().addMessageFromBackend(a.message)}});c.getInstance=function e(){if(!c._instance){c._instance=new c}return c._instance};return c});