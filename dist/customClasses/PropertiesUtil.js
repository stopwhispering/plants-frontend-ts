sap.ui.define(["plants/ui/customClasses/Util","sap/m/MessageToast","plants/ui/model/ModelsHelper","plants/ui/customClasses/MessageUtil","sap/ui/model/json/JSONModel","sap/ui/base/ManagedObject"],function(e,t,r,o,a,p){function n(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const i=n(r);const s=n(o);const l=p.extend("plants.ui.customClasses.PropertiesUtil",{constructor:function e(t){p.prototype.constructor.call(this);this.applyToFragment=t},editPropertyValueDelete:function e(t,r,o,a){var p=o.getPath();var n=o.getObject();if(n.type==="taxon"){var i=p.substr(0,p.lastIndexOf("/"));var s=i.substr(0,i.lastIndexOf("/"));var l=t.getProperty(s).property_name_id;var d=s.substr(0,s.lastIndexOf("/"));var y=d.substr(0,d.lastIndexOf("/"));var _=t.getProperty(y).category_id;var c=a.taxon_id;var u="/propertiesTaxon/"+c+"/"+_+"/properties";var g=r.getProperty(u);var v=g.find(e=>e["property_name_id"]==l);var f=v.property_values.find(e=>e["type"]=="taxon");var x=v.property_values.indexOf(f);v.property_values.splice(x,1);if(v.property_values.length===0){var m=g.indexOf(v);g.splice(m,1)}}i=p.substr(0,p.lastIndexOf("/"));var P=t.getProperty(i);var h=P.indexOf(n);P.splice(h,1);t.refresh()},_getTemporaryAvailablePropertiesModel:function e(t,r){var o="/propertiesAvailablePerCategory/"+t.category_name;var p=r.getProperty(o);var n=this._comparePropertiesLists(p,t.properties);return new a(n)},_comparePropertiesLists:function e(t,r){var o=[];if(t===undefined){t=[]}t.forEach(function(e){var t=e.property_name;var a=r.find(e=>e.property_name===t);let p,n,i,s;if(a&&a.property_values.find(e=>e.type==="plant")){p=true;i=true}else{p=false;i=false}if(a&&a.property_values.find(e=>e.type==="taxon")){n=true;s=true}else{n=false;s=false}var l={property_name:t,property_name_id:e.property_name_id,selected_plant:p,selected_taxon:n,blocked_plant:i,blocked_taxon:s};o.push(l)});return o},openDialogNewProperty:function e(r,o){if(!r.taxon_id){t.show("Function available after setting botanical name.");return}var a=o.getBindingContext("properties").getPath();this.applyToFragment("dialogNewPropertyName",e=>{e.bindElement({path:a,model:"properties"});e.openBy(o,true)});this._btnNew=o;this._btnNew.setType("Emphasized")},createNewPropertyName:function e(r,o){var a=o.byId("inpPropertyName").getValue();if(!a){t.show("Enter Property Name.");return}const p=r.getBindingContext("properties").getObject();var n=p.category_name;var i=r.getModel("propertyNames");var s=i.getProperty("/propertiesAvailablePerCategory/"+n);var l=s.find(e=>e["property_name"]==a);if(l){t.show("Property Name already exists.");return}s.push({countPlants:0,property_name:a});var d=o.byId("chkNewPropertyNameAddToPlant").getSelected();var y=o.byId("chkNewPropertyNameAddToTaxon").getSelected();if(d){const e={type:"plant",property_value:""};const t={property_name:a,property_values:[e]};p.properties.push(t)}if(y){const e={type:"taxon",property_value:""};var _={property_name:a,property_values:[e]};p.properties.push(_);var c={property_name:a,property_name_id:undefined};var u=r.getBindingContext("plants").getObject();const t=o.getModel("propertiesTaxa");const n={type:"taxon",property_value:""};this._insertPropertyIntoPropertiesTaxaModel(n,p.category_id,u.taxon_id,c,t)}o.getModel("properties").refresh();o.byId("dialogNewPropertyName").close();this._btnNew.setType("Transparent")},closeNewPropertyNameDialog:function e(){this._btnNew.setType("Transparent")},openDialogAddProperty:function e(r,o,a){if(!o.taxon_id){t.show("Function available after setting botanical name.");return}var p=a.getBindingContext("properties").getObject();var n=a.getBindingContext("properties").getPath();if(r.byId("dialogAddProperties")){r.byId("dialogAddProperties").destroy()}const i=a.getModel("propertyNames");this.applyToFragment("dialogAddProperties",e=>{var t=this._getTemporaryAvailablePropertiesModel(p,i);e.setModel(t,"propertiesCompare");e.bindElement({path:n,model:"properties"});e.openBy(a,true)});a.setType("Emphasized");this._btnAdd=a},addProperty:function e(t,r){var o=r.getModel("propertiesCompare").getData();const a=r.getBindingContext("properties").getObject();var p=a.properties;var n=a.category_id;var i=r.getBindingContext("plants").getObject().taxon_id;for(var s=0;s<o.length;s++){var l=o[s];if(l.selected_plant&&!l.blocked_plant||l.selected_taxon&&!l.blocked_taxon){var d=p.find(e=>e.property_name_id==l.property_name_id);if(d){if(l.selected_plant&&!l.blocked_plant){d.property_values.push({type:"plant",property_value:""})}if(l.selected_taxon&&!l.blocked_taxon){var y={type:"taxon",property_value:""};d.property_values.push(y);const e=t.getModel("propertiesTaxa");this._insertPropertyIntoPropertiesTaxaModel(y,n,i,l,e)}}else{var _=[];if(l.selected_plant&&!l.blocked_plant){_.push({type:"plant",property_value:""})}if(l.selected_taxon&&!l.blocked_taxon){var c={type:"taxon",property_value:""};_.push(c);const e=t.getModel("propertiesTaxa");this._insertPropertyIntoPropertiesTaxaModel(c,n,i,l,e)}a.properties.push({property_name:l.property_name,property_name_id:l.property_name_id,property_values:_})}}}t.getModel("properties").refresh();this._btnAdd.setType("Transparent");const u=t.byId("dialogAddProperties");u.close();u.destroy()},_insertPropertyIntoPropertiesTaxaModel:function e(t,r,o,a,p){var n=p.getData().propertiesTaxon[o][r].properties;if(a.property_name_id){var i=n.find(e=>e.property_name_id==a.property_name_id)}else{i=n.find(e=>e.property_name==a.property_name)}if(!i){n.push({property_name:a.property_name,property_name_id:a.property_name_id,property_values:[t]})}else{i.property_values.push(t)}},_taxon_properties_already_loaded:function e(t,r){if(t.getModel("propertiesTaxa").getProperty("/propertiesTaxon/"+r))return true;else return false},loadPropertiesForCurrentPlant:function t(r,o){var a=encodeURIComponent(r.id);var p="plant_properties/"+a;if(r.taxon_id&&!this._taxon_properties_already_loaded(o,r.taxon_id))var n={taxon_id:r.taxon_id};else n={};$.ajax({url:e.getServiceUrl(p),data:n,context:this,async:true}).done(this._onReceivingPropertiesForPlant.bind(this,r,o)).fail(i.getInstance().onReceiveErrorGeneric.bind(this,"Property (GET)"))},_onReceivingPropertiesForPlant:function t(r,o,a,p,n){var i=o.getModel("properties");i.setProperty("/propertiesPlants/"+r.id+"/",a.propertyCollections);if(!o.oPropertiesDataClone){o.oPropertiesDataClone={}}o.oPropertiesDataClone[r.id]=e.getClonedObject(a.propertyCollections);if(Object.keys(a.propertyCollectionsTaxon.categories).length>0){o.getModel("propertiesTaxa").setProperty("/propertiesTaxon/"+r.taxon_id+"/",a.propertyCollectionsTaxon.categories);if(!o.oPropertiesTaxonDataClone){o.oPropertiesTaxonDataClone={}}o.oPropertiesTaxonDataClone[r.taxon_id]=e.getClonedObject(a.propertyCollectionsTaxon.categories)}this._appendTaxonPropertiesToPlantProperties(o,r);s.getInstance().addMessageFromBackend(a.message);i.refresh(true)},_appendTaxonPropertiesToPlantProperties:function e(t,r){if(!r.taxon_id){return}var o=t.getModel("propertiesTaxa");var a=t.getModel("properties");var p=o.getProperty("/propertiesTaxon/"+r.taxon_id+"/");var n=a.getProperty("/propertiesPlants/"+r.id+"/categories/");const i=Object.keys(p).map(e=>parseInt(e));for(var s=0;s<Object.keys(p).length;s++){var l=p[i[s]];var d=l.category_id;var y=n.find(e=>e.category_id==d);for(var _=0;_<l.properties.length;_++){var c=l.properties[_];var u=y.properties.find(e=>e.property_name_id==c.property_name_id);if(u){u.property_values.push(...c.property_values)}else{y.properties.push(c)}}}}});l.getInstance=function e(t){if(!l._instance&&t){l._instance=new l(t)}return l._instance};return l});