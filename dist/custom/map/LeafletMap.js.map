{"version":3,"file":"LeafletMap.js","names":["sap","ui","define","jQuery","Control","LeafletMap","extend","metadata","library","properties","type","defaultValue","defaultVlaue","prototype","init","_initTdwg","onAfterRendering","map","L","setView","getDefaultZoomLevel","getDrawOpenStreetMap","_drawGeoOpenStreetMaps","$","ajax","url","getGeoJsonUrl","dataType","context","complete","data","geoJsonData","responseJSON","getDrawGeoJsonMap","setDrawGeoJsonMap","getGeoJsonHighlights","setGeoJsonHighlights","bDrawGeoJsonMap","setProperty","_drawGeoJson","aGeoJsonHighlights","_resetGeoJsonLayers","highlightAreas","getPermanentTooltips","tileLayer","getTemplateUrl","maxZoom","attribution","getAttribution","addTo","myStyle","oGeoJson","removeFrom","geoJSON","style","aAreas","bPermanentTooltips","length","getHighlightColor","sPropertyKey","getGeoJsonPropertyKey","aAreaGeoJson","features","filter","element","includes","forEach","oAreaGeoJson","bindTooltip","LEVEL3_NAM","permanent","offset","_panToCenterAndSetZoom","_getGeoJsonLayers","bIncludeTooltips","aLayerIds","Object","keys","_layers","aGeoJsonLayers","iLayerId","feature","push","_tooltip","i","remove","_getMinOrMax","aMinMax","key","sign","oMin","reduce","p","v","oMax","getAutoPanToSelectedAreas","aFlattened","_latlngs","flat","j","lng","lat","aTransposed","_transpose","_getMinMaxOfPolygon","min_x","min_y","max_x","max_y","x_avg","y_avg","getAutoZoom","iSpanX","iSpanY","iCurrentSpanX","getBounds","getEast","getWest","iCurrentSpanY","getNorth","getSouth","mLatLngCoveringAll","fitBounds","panTo","aLatLng","arrayMin","arr","arrayMax","mMinMax","matrix","rows","cols","grid","Array"],"sources":["../../../src/custom/map/LeafletMap.js"],"sourcesContent":["sap.ui.define(\r\n\t[\r\n\t\t'jquery.sap.global',\r\n\t\t'sap/ui/core/Control'\r\n\t\t// './library'\r\n\t],\r\n\r\n\tfunction(jQuery, Control) {\r\n\t\t\"use strict\";\r\n\r\n\t\tvar LeafletMap = Control.extend('custom.map.LeafletMap', {\r\n\r\n\t\t\t// metadata section defines the API of the control (properties, events, aggregations; automatically\r\n\t\t\t// creates convenience functions)\r\n\t\t\tmetadata: {\r\n\t\t\t\tlibrary: 'custom.map',\r\n\t\t\t\tproperties: {\r\n\t\t\t\t\t\"width\": {\r\n\t\t\t\t\t\ttype: 'sap.ui.core.CSSSize',\r\n\t\t\t\t\t\tdefaultValue: '800px'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"height\": {\r\n\t\t\t\t\t\ttype: 'sap.ui.core.CSSSize',\r\n\t\t\t\t\t\tdefaultValue: '500px'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"geoJsonHighlights\": {\r\n\t\t\t\t\t\ttype: 'string[]'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"highlightColor\": {\r\n\t\t\t\t\t\ttype: 'string',\r\n\t\t\t\t\t\tdefaultValue: '#ff7800'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"permanentTooltips\": {\r\n\t\t\t\t\t\ttype: 'boolean',\r\n\t\t\t\t\t\tdefaultValue: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"drawOpenStreetMap\": {\r\n\t\t\t\t\t\ttype: 'boolean',\r\n\t\t\t\t\t\tdefaultValue: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"drawGeoJsonMap\": {\r\n\t\t\t\t\t\ttype: 'boolean',\r\n\t\t\t\t\t\tdefaultValue: false\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"defaultZoomLevel\": {\r\n\t\t\t\t\t\ttype: 'int',\r\n\t\t\t\t\t\tdefaultVlaue: 4\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"autoZoom\": {\r\n\t\t\t\t\t\ttype: 'boolean',\r\n\t\t\t\t\t\tdefaultValue: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"autoPanToSelectedAreas\": {\r\n\t\t\t\t\t\ttype: 'boolean',\r\n\t\t\t\t\t\tdefaultValue: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"geoJsonUrl\": {\r\n\t\t\t\t\t\ttype: 'string',\r\n\t\t\t\t\t\tdefaultValue: \"./custom/map/level3.geojson\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"geoJsonPropertyKey\": { //properties key in geojson file to identify highlighting areas\r\n\t\t\t\t\t\ttype: 'string',\r\n\t\t\t\t\t\tdefaultValue: \"LEVEL3_COD\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"templateUrl\": {\r\n\t\t\t\t\t\ttype: 'string',\r\n\t\t\t\t\t\tdefaultValue: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\"attribution\": {\r\n\t\t\t\t\t\ttype: 'string',\r\n\t\t\t\t\t\tdefaultValue: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tLeafletMap.prototype.init = function() {\r\n\t\t\t// load geojson data, optionally draw full map\r\n\t\t\tthis._initTdwg();\r\n\t\t};\r\n\r\n\t\tLeafletMap.prototype.onAfterRendering = function() {\r\n\t\t\t// initialize blank map\r\n\t\t\tthis.map = L.map('map').setView([51.505, -0.09], this.getDefaultZoomLevel()); //pos, zoom-level;  store globally (there is probably a better way...)\r\n\r\n\t\t\t// optionally draw openstreetmap map of the world, \r\n\t\t\t// optionally enhanced with mapbox (requiring token)\r\n\t\t\tif (this.getDrawOpenStreetMap()) {\r\n\t\t\t\tthis._drawGeoOpenStreetMaps();\r\n\t\t\t}\r\n\r\n\t\t};\r\n\t\t\r\n\t\tLeafletMap.prototype._initTdwg = function() {\r\n\t\t\t// get Biodiversity Information Standards borders (level 3)\r\n\t\t\t// see https://en.wikipedia.org/wiki/List_of_codes_used_in_the_World_Geographical_Scheme_for_Recording_Plant_Distributions\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: this.getGeoJsonUrl(),\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tcontext: this,\r\n\t\t\t\tcomplete(data) {\r\n\t\t\t\t\tthis.geoJsonData = data.responseJSON;\r\n\t\t\t\t\tif (this.getDrawGeoJsonMap()) {\r\n\t\t\t\t\t\tthis.setDrawGeoJsonMap(this.getDrawGeoJsonMap());\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.getGeoJsonHighlights()) {\r\n\t\t\t\t\t\t//first binding\r\n\t\t\t\t\t\tthis.setGeoJsonHighlights(this.getGeoJsonHighlights());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\t\t\r\n\r\n\t\tLeafletMap.prototype.setDrawGeoJsonMap = function(bDrawGeoJsonMap) {\r\n\t\t\tthis.setProperty('drawGeoJsonMap', bDrawGeoJsonMap);\r\n\t\t\tif (this.geoJsonData) {\r\n\t\t\t\tthis._drawGeoJson(bDrawGeoJsonMap);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tLeafletMap.prototype.setGeoJsonHighlights = function(aGeoJsonHighlights) {\r\n\t\t\t//we need this setter method as otherwise upon upbdate bindings nothing happens\r\n\r\n\t\t\t//we need to set this manually as we are overwriting the default setter method\r\n\t\t\tthis.setProperty('geoJsonHighlights', aGeoJsonHighlights);\r\n\r\n\t\t\t//used as event handler when updating binding after initialization\r\n\t\t\t//called directly at first call\r\n\t\t\tif (this.geoJsonData) {\r\n\t\t\t\tthis._resetGeoJsonLayers();\r\n\t\t\t\tthis.highlightAreas(aGeoJsonHighlights, this.getPermanentTooltips);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\r\n\r\n\t\tLeafletMap.prototype._drawGeoOpenStreetMaps = function() {\r\n\t\t\tL.tileLayer(this.getTemplateUrl(), {\r\n\t\t\t\tmaxZoom: 18,\r\n\t\t\t\tattribution: this.getAttribution()\r\n\t\t\t}).addTo(this.map);\r\n\r\n\t\t};\r\n\r\n\t\tLeafletMap.prototype._drawGeoJson = function() {\r\n\t\t\tvar myStyle = {\r\n\t\t\t\t\"color\": \"#925522\", //color of border\r\n\t\t\t\t\"weight\": 1, //thickness of border\r\n\t\t\t\t\"opacity\": 0.65, //opacity of border\r\n\t\t\t\t\"fill\": true, //fill area \r\n\t\t\t\t\"fillColor\": \"#ffffef\", //default: border color\r\n\t\t\t\t\"fillOpacity\": 1.0\r\n\t\t\t};\r\n\r\n\t\t\tif (this.oGeoJson) {\r\n\t\t\t\tthis.oGeoJson.removeFrom(this.map);\r\n\t\t\t}\r\n\t\t\tthis.oGeoJson = L.geoJSON(this.geoJsonData, {\r\n\t\t\t\tstyle: myStyle\r\n\t\t\t}).addTo(this.map);\r\n\t\t};\r\n\r\n\t\tLeafletMap.prototype.highlightAreas = function(aAreas, bPermanentTooltips) {\r\n\t\t\tif (!aAreas || !aAreas.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\t\t\t\r\n\t\t\tvar myStyle = {\r\n\t\t\t\t\"color\": this.getHighlightColor(), //color of border\r\n\t\t\t\t\"weight\": 1, //thickness of border\r\n\t\t\t\t\"opacity\": 0.65, //opacity of border\r\n\t\t\t\t\"fill\": true, //fill area \r\n\t\t\t\t// \"fillColor\": //default: border color\r\n\t\t\t\t\"fillOpacity\": 0.2\r\n\t\t\t};\r\n\r\n\t\t\tvar sPropertyKey = this.getGeoJsonPropertyKey();\r\n\t\t\tvar aAreaGeoJson = this.geoJsonData.features.filter(function(element) {\r\n\t\t\t\treturn aAreas.includes(element.properties[sPropertyKey]);\r\n\t\t\t});\r\n\t\t\tif (!aAreaGeoJson.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\taAreaGeoJson.forEach(function(oAreaGeoJson) {\r\n\t\t\t\tL.geoJSON(oAreaGeoJson, {\r\n\t\t\t\t\t\tstyle: myStyle\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.bindTooltip(oAreaGeoJson.properties.LEVEL3_NAM + ' (' + oAreaGeoJson.properties[this.getGeoJsonPropertyKey()] + ')', {\r\n\t\t\t\t\t\tpermanent: bPermanentTooltips,\r\n\t\t\t\t\t\toffset: [0, 0]\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.addTo(this.map);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis._panToCenterAndSetZoom();\r\n\t\t};\r\n\r\n\t\tLeafletMap.prototype._getGeoJsonLayers = function(bIncludeTooltips) {\r\n\t\t\tvar aLayerIds = Object.keys(this.map._layers);\r\n\t\t\tvar aGeoJsonLayers = [];\r\n\t\t\taLayerIds.forEach(function(iLayerId) {\r\n\t\t\t\tif (this.map._layers[iLayerId].feature) {\r\n\t\t\t\t\taGeoJsonLayers.push(this.map._layers[iLayerId]);\r\n\t\t\t\t} else if (bIncludeTooltips && this.map._layers[iLayerId]._tooltip) {\r\n\t\t\t\t\taGeoJsonLayers.push(this.map._layers[iLayerId]);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\treturn aGeoJsonLayers;\r\n\t\t};\r\n\r\n\t\tLeafletMap.prototype._resetGeoJsonLayers = function() {\r\n\t\t\tvar aGeoJsonLayers = this._getGeoJsonLayers(true);\r\n\t\t\tfor (var i = 0; i < aGeoJsonLayers.length; i++) {\r\n\t\t\t\taGeoJsonLayers[i].remove();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tLeafletMap.prototype._getMinOrMax = function(aMinMax, key, sign) {\r\n\t\t\tif (sign === 'min') {\r\n\t\t\t\tvar oMin = aMinMax.reduce(function(p, v) {\r\n\t\t\t\t\treturn (p[key] < v[key] ? p : v);\r\n\t\t\t\t});\r\n\t\t\t\treturn oMin[key];\r\n\t\t\t} else if (sign === 'max') {\r\n\t\t\t\tvar oMax = aMinMax.reduce(function(p, v) {\r\n\t\t\t\t\treturn (p[key] > v[key] ? p : v);\r\n\t\t\t\t});\r\n\t\t\t\treturn oMax[key];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tLeafletMap.prototype._panToCenterAndSetZoom = function() {\r\n\r\n\t\t\tvar aGeoJsonLayers = this._getGeoJsonLayers(false);\r\n\t\t\tif (!aGeoJsonLayers) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.getAutoPanToSelectedAreas()) {\r\n\t\t\t\t// get min/max among all polygons\r\n\t\t\t\tvar aMinMax = [];\r\n\t\t\t\tfor (var i = 0; i < aGeoJsonLayers.length; i++) {\r\n\t\t\t\t\t//convert\r\n\t\t\t\t\tvar aFlattened = aGeoJsonLayers[i]._latlngs.flat(2);\r\n\t\t\t\t\tfor (var j = 0; j < aFlattened.length; j++) {\r\n\t\t\t\t\t\taFlattened[j] = [aFlattened[j].lng, aFlattened[j].lat];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar aTransposed = this._transpose(aFlattened);\r\n\t\t\t\t\taMinMax.push(this._getMinMaxOfPolygon(aTransposed));\r\n\t\t\t\t}\r\n\t\t\t\t// total min/max on x and y axis\r\n\t\t\t\tvar min_x = this._getMinOrMax(aMinMax, 'min_x', 'min');\r\n\t\t\t\tvar min_y = this._getMinOrMax(aMinMax, 'min_y', 'min');\r\n\t\t\t\tvar max_x = this._getMinOrMax(aMinMax, 'max_x', 'max');\r\n\t\t\t\tvar max_y = this._getMinOrMax(aMinMax, 'max_y', 'max');\r\n\r\n\t\t\t\t// pan to the center\r\n\t\t\t\t// to do in some spare time: consider that the earth is round\r\n\t\t\t\tvar x_avg = (min_x + max_x) / 2;\r\n\t\t\t\tvar y_avg = (min_y + max_y) / 2;\r\n\r\n\t\t\t\tif (this.getAutoZoom()) {\r\n\t\t\t\t\t// make sure zoom level hase everything in visible area\r\n\t\t\t\t\tvar iSpanX = max_x - min_x;\r\n\t\t\t\t\tvar iSpanY = max_y - min_y;\r\n\t\t\t\t\tvar iCurrentSpanX = this.map.getBounds().getEast() - this.map.getBounds().getWest();\r\n\t\t\t\t\tvar iCurrentSpanY = this.map.getBounds().getNorth() - this.map.getBounds().getSouth();\r\n\r\n\t\t\t\t\tif (iSpanX <= iCurrentSpanX && iSpanY <= iCurrentSpanY) {\r\n\t\t\t\t\t\t// default zoom level if that fits\r\n\t\t\t\t\t\tthis.map.setView([y_avg, x_avg], this.getDefaultZoomLevel());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// zoom up if required\r\n\t\t\t\t\t\tvar mLatLngCoveringAll = [\r\n\t\t\t\t\t\t\t[min_y, min_x],\r\n\t\t\t\t\t\t\t[max_y, max_x]\r\n\t\t\t\t\t\t];\r\n\t\t\t\t\t\tthis.map.fitBounds(mLatLngCoveringAll);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.map.panTo({\r\n\t\t\t\t\t\tlng: x_avg,\r\n\t\t\t\t\t\tlat: y_avg\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// LeafletMap.prototype._getCenterOfPolygon = function(oFeature) {\r\n\t\t// \tvar aFlattened = oFeature.geometry.coordinates.flat(2);\r\n\t\t// \tvar aTransposed = this._transpose(aFlattened);\r\n\t\t// \tvar mMinMax = this._getMinMaxOfPolygon(aTransposed);\r\n\t\t// \treturn {\r\n\t\t// \t\tx_center: (mMinMax.min_x + mMinMax.max_x) / 2,\r\n\t\t// \t\ty_center: (mMinMax.min_y + mMinMax.max_y) / 2\r\n\t\t// \t};\r\n\t\t// };\r\n\r\n\t\tLeafletMap.prototype._getMinMaxOfPolygon = function(aLatLng) {\r\n\r\n\t\t\tvar arrayMin = function(arr) {\r\n\t\t\t\treturn arr.reduce(function(p, v) {\r\n\t\t\t\t\treturn (p < v ? p : v);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tvar arrayMax = function(arr) {\r\n\t\t\t\treturn arr.reduce(function(p, v) {\r\n\t\t\t\t\treturn (p > v ? p : v);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tvar mMinMax = {\r\n\t\t\t\tmin_x: arrayMin(aLatLng[0]),\r\n\t\t\t\tmax_x: arrayMax(aLatLng[0]),\r\n\t\t\t\tmin_y: arrayMin(aLatLng[1]),\r\n\t\t\t\tmax_y: arrayMax(aLatLng[1])\r\n\t\t\t};\r\n\r\n\t\t\t// console.log('X: '+min_x+' to '+max_x+' y: '+min_y+' to '+max_y);\r\n\t\t\treturn mMinMax;\r\n\t\t};\r\n\r\n\t\tLeafletMap.prototype._transpose = function(matrix) {\r\n\t\t\t// transpose 2-d array\r\n\t\t\t// no map functions in web ide\r\n\t\t\tvar rows = matrix.length,\r\n\t\t\t\tcols = matrix[0].length;\r\n\t\t\tvar grid = [];\r\n\t\t\tfor (var j = 0; j < cols; j++) {\r\n\t\t\t\tgrid[j] = Array(rows);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < rows; i++) {\r\n\t\t\t\tfor (j = 0; j < cols; j++) {\r\n\t\t\t\t\tgrid[j][i] = matrix[i][j];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn grid;\r\n\t\t};\r\n\r\n\t\treturn LeafletMap;\r\n\t}, true);"],"mappings":"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"}