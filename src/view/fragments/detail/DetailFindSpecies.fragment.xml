<core:FragmentDefinition
	xmlns="sap.m"
	xmlns:l="sap.ui.layout"
	xmlns:f="sap.f"
	xmlns:core="sap.ui.core"
>
	<Dialog
		title="Find Species"
		stretch="{device>/system/phone}"
		id="dialogFindSpecies"
		class="sapUiContentPadding"
		contentWidth="92em"
	>
		<!-- beforeOpen=".onBeforeOpenSearchSpeciesDialog" -->
		<content>
			<HBox>
				<VBox class="sapUiSmallMarginEnd">
					<Label text="Botanical name"/>
					<HBox>
						<Input
							maxLength="40"
							width="12em"
							submit=".onButtonFindSpecies"
							id="inputSearchPattern"
							value="{searchSpeciesInput>/searchPattern}"
							class="sapUiTinyMarginEnd"
						/>
						<Button
							text="Search"
							press=".onButtonFindSpecies"
						/>
					</HBox>
				</VBox>
				<HBox>
					<CheckBox
						selected="{searchSpeciesInput>/includeExternalApis}"
						text="Use &quot;Plants of the World&quot; Online Database"
					/>
					<CheckBox
						selected="{searchSpeciesInput>/genusNotSpecies}"
						text="Unknown Species, search for genus instead"
					/>
				</HBox>
			</HBox>
			<ScrollContainer
				height="28rem"
				width="100%"
				vertical="true"
				horizontal="false"
				focusable="true"
			>
				<Table
					id="tableFindSpeciesResults"
					selectionChange=".onFindSpeciesTableSelectedOrDataUpdated"
					updateFinished=".onFindSpeciesTableSelectedOrDataUpdated"
					mode="SingleSelectMaster"
					items="{
						path: 'kewSearchResults>/ResultsCollection'
					}"
				>
					<columns>
						<Column width="13em">
							<Text text="Name &amp; Source"/>
						</Column>
						<Column
							minScreenWidth="Tablet"
							demandPopin="true"
							width="8em"
						>
							<Text text="Tax. Status &amp; Custom"/>
						</Column>
						<Column
							minScreenWidth="Tablet"
							demandPopin="true"
							width="10em"
						>
							<Text text="IPNI (Int. Plant Name Index)"/>
						</Column>
						<Column width="8em">
							<Text text="Genus &amp; Species"/>
						</Column>
						<Column
							minScreenWidth="Tablet"
							demandPopin="true"
							width="8em"
						>
							<Text text="Rank &amp; Infraspecies"/>
						</Column>
						<Column
							minScreenWidth="Tablet"
							demandPopin="true"
							width="8em"
						>
							<Text text="Family &amp; Phylum"/>
						</Column>
						<Column width="10em">
							<Text text="Authors &amp; Publ. Year"/>
						</Column>
						<Column
							minScreenWidth="Tablet"
							demandPopin="true"
							width="19em"
						>
							<Text text="Synonyms"/>
						</Column>
						<Column
							minScreenWidth="Tablet"
							demandPopin="true"
							width="19em"
						>
							<Text text="Distribution"/>
						</Column>
					</columns>
					<items>
						<ColumnListItem>
							<cells>
								<!-- {kewSearchResults>rank}  -->
								<ObjectIdentifier
									title="{kewSearchResults>name}"
									text="{
										parts: ['kewSearchResults>source', 'kewSearchResults>count', 'kewSearchResults>count_inactive'],
										formatter: '.formatter.sourceAndCount'
									}"
								/>
								<ObjectIdentifier
									title="{kewSearchResults>taxonomic_status}"
									text="{kewSearchResults>is_custom}"
								/>
								<Text text="{
									parts: ['kewSearchResults>lsid', 'kewSearchResults>is_custom'],
									formatter: '.formatter.ipniOrCustomName'
								}"/>
								<ObjectIdentifier
									title="{kewSearchResults>genus}"
									text="{kewSearchResults>species}"
								/>
								<ObjectIdentifier
									title="{kewSearchResults>rank}"
									text="{kewSearchResults>infraspecies}"
								/>
								<ObjectIdentifier
									title="{kewSearchResults>family}"
									text="TODOOOOOOOOO"
								/>
								<ObjectIdentifier
									title="{kewSearchResults>authors}"
									text="{kewSearchResults>namePublishedInYear}"
								/>
								<HBox>
									<Text
										text="{kewSearchResults>synonyms_concat}"
										visible="{= ${kewSearchResults>synonym} === false }"
									/>
									<MessageStrip
										text="{kewSearchResults>synonyms_concat}"
										type="Warning"
										showIcon="true"
										visible="{kewSearchResults>synonym}"
									/>
								</HBox>
								<Text text="{kewSearchResults>distribution_concat}"/>
							</cells>
						</ColumnListItem>
					</items>
				</Table>
			</ScrollContainer>
			<f:Card
				class="sapUiSmallMarginTopBottom"
				visible="{searchSpeciesInput>/resultSelected}"
			>
				<f:content>
					<HBox>
						<VBox class="sapUiSmallMarginTop sapUiSmallMarginBegin">
							<Label
								text="{i18n>label_additional_species_name}"
								tooltip="{i18n>label_additional_species_name}"
								width="5rem"
								wrapping="true"
							/>
							<Switch
								customTextOn=""
								customTextOff=""
								enabled="{customTaxonInput>/editable}"
								state="{customTaxonInput>/newCustomTaxon}"
								change=".onCustomTaxonChange"
							/>
						</VBox>
						<HBox class="sapUiSmallMarginTop">
							<VBox class="sapUISmallMargin">
								<Label
									text="Custom Infraspecies"
									labelFor="inputFindSpeciesAdditionalName"
									class="sapUiTinyMarginEnd"
								/>
								<RadioButtonGroup editable="{=
									${customTaxonInput>/newCustomTaxon} &amp;&amp; ${customTaxonInput>/editable} &amp;&amp; ${customTaxonInput>/editableCustomInfraspecies}
								}">
									<RadioButton
										text="None"
										selected="{customTaxonInput>/customRankNone}"
									/>
									<RadioButton
										text="Subspecies"
										selected="{customTaxonInput>/customRankSubspecies}"
									/>
									<RadioButton
										text="Variety"
										selected="{customTaxonInput>/customRankVariety}"
									/>
									<RadioButton
										text="Forma"
										selected="{customTaxonInput>/customRankForma}"
									/>
								</RadioButtonGroup>
							</VBox>
							<VBox
								justifyContent="Center"
								class="sapUISmallMargin"
							>
								<Label
									text="Infraspecies Name"
									class="sapUiTinyMarginEnd"
								/>
								<Input
									maxLength="40"
									width="8em"
									change=".onFindSpeciesAdditionalNameLiveChange"
									editable="{= 
										!(${customTaxonInput>/customRankNone}) &amp;&amp; ${customTaxonInput>/editable} &amp;&amp; ${customTaxonInput>/editableCustomInfraspecies}
									}"
									value="{customTaxonInput>/customInfraspecies}"
									class="sapUiSmallMarginEnd"
								/>
							</VBox>
							<VBox
								justifyContent="Center"
								class="sapUISmallMargin"
							>
								<Label
									text="Cultivar"
									class="sapUiTinyMarginEnd"
								/>
								<Input
									maxLength="30"
									width="6em"
									change=".onFindSpeciesAdditionalNameLiveChange"
									editable="{=
										${customTaxonInput>/newCustomTaxon} &amp;&amp; ${customTaxonInput>/editable}
									}"
									value="{customTaxonInput>/cultivar}"
									class="sapUiSmallMarginEnd"
								/>
							</VBox>
							<VBox
								justifyContent="Center"
								class="sapUISmallMargin"
							>
								<Label text="Species affinis"/>
								<Input
									maxLength="40"
									width="8em"
									change=".onFindSpeciesAdditionalNameLiveChange"
									editable="{=
										${customTaxonInput>/newCustomTaxon} &amp;&amp; ${customTaxonInput>/editable}
									}"
									value="{customTaxonInput>/affinis}"
									class="sapUiSmallMarginEnd"
								/>
							</VBox>
							<VBox
								justifyContent="Center"
								class="sapUISmallMargin"
							>
								<Label
									text="Custom Suffix"
									labelFor="inputFindSpeciesAdditionalName"
									class="sapUiTinyMarginEnd"
								/>
								<Input
									maxLength="30"
									width="6em"
									change=".onFindSpeciesAdditionalNameLiveChange"
									id="inputFindSpeciesAdditionalName"
									editable="{=
										${customTaxonInput>/newCustomTaxon} &amp;&amp; ${customTaxonInput>/editable}
									}"
									value="{customTaxonInput>/customSuffix}"
									class="sapUiSmallMarginEnd"
								/>
							</VBox>
							<VBox
								visible="{customTaxonInput>/newCustomTaxon}"
								class="sapUISmallMargin"
							>
								<Label
									text="Preview"
									labelFor="textFindSpeciesAdditionalName"
									class="sapUiTinyMarginEnd"
								/>
								<Text
									text="{botanicalNamePreview>/name}"
								/>
								<FormattedText
									htmlText="{botanicalNamePreview>/full_html_name}"
								/>
							</VBox>
						</HBox>
					</HBox>
				</f:content>
			</f:Card>
		</content>
		<beginButton>
			<Button
				text="Assign &amp; Save"
				press=".onAssignTaxon"
			/>
		</beginButton>
		<endButton>
			<Button
				text="Cancel"
				press=".onCancelSearchSpeciesDialog"
			/>
		</endButton>
	</Dialog>
</core:FragmentDefinition>